


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		<meta content="Vision, Library, Vitis Vision AIE Library, overview, features, kernel" name="keywords" />
<meta content="Using the Vitis Vision AIE library." name="description" />
<meta content="Document" name="xlnxdocumentclass" />
<meta content="Tutorials" name="xlnxdocumenttype" />
<meta content="Vision, Library, Vitis Vision AIE Library, design, methodology, AIE, ADF, ACAP, OpenCV" name="keywords" />
<meta content="Describes Describes the methodology to accelerate Vitis Vision AIE library functions on Versal adaptive compute acceleration platforms (ACAPs)" name="description" />
<meta content="Document" name="xlnxdocumentclass" />
<meta content="Tutorials" name="xlnxdocumenttype" />

		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

  
  
  
  

  
      <script type="text/javascript" src="_static/js/jquery.min.js"></script>
	  <script type="text/javascript" src="_static/js/gtm.js"></script>
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="_static/js/common-ui-all.min.js"></script>
    <script type="text/javascript" src="_static/js/header-footer.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="_static/js/CoveoJsSearch.Lazy.min.js"></script>
    <script type="text/javascript" src="_static/js/linkid.js"></script>
    <script type="text/javascript" src="_static/js/Searchbox.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/pro.min.css" media="all" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Overview" href="api-reference.html" />
    <link rel="prev" title="Overview" href="overview.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="header parbase aem-GridColumn aem-GridColumn--default--12">
								<noindex>
									<header data-component="header">
										<nav class="navbar navbar-default aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid main-nav">
													<div class="row">
														<div class="col-xs-12">
															<div class="logo-column">
																<div class="logo">
																	<a href="https://www.xilinx.com/">
																	<img src="https://github.com/Xilinx/Image-Collateral/blob/main/xilinx-header-logo.svg?raw=true" title="Xilinx Inc"/>
																	</a>
																</div>
															</div>
															<div class="navbar-column">
																<div class="navbar navbar-collapse collapse" id="xilinx-main-menu">
																	<div class="mobile-search-container">
																		<div id="headerSearchBox" class="headerSearch"
																			data-component="header-search"
																			data-redirect-if-empty="false"
																			data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																			data-coveo-organization-id="xilinxcomprode2rjoqok">
																			<div class='coveo-search-section'>
																				<div class="CoveoAnalytics" data-search-hub="Site"></div>
																				<ul class="dropdown-menu options">
																					<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																						<a href="#">
																						All</a>
																					</li>
																					<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com//products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Silicon Devices</a>
																					</li>
																					<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com//products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Boards and Kits</a>
																					</li>
																					<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com//products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Intellectual Property</a>
																					</li>
																					<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																						<a href="#">
																						Support</a>
																						<ul>
																							<li data-label="Documentation" data-action-link="https://www.xilinx.com//support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																								<a href="#">
																								Documentation</a>
																							</li>
																							<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com//support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																								<a href="#">
																								Knowledge Base</a>
																							</li>
																							<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																								<a href="#">
																								Community Forums</a>
																							</li>
																						</ul>
																					</li>
																					<li data-label="Partners" data-action-link="https://www.xilinx.com//alliance/member-keyword-search.html" data-search-hub="Partner">
																						<a href="#">
																						Partners</a>
																					</li>
																					<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																						<a href="#">
																						Videos</a>
																					</li>
																					<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																						<a href="#">
																						Press</a>
																					</li>
																				</ul>
																				<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																				<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																			</div>
																		</div>
																	</div>
																	<ul class="nav navbar-nav nav-justified">
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/applications.html">
																			Applications</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/products/silicon-devices.html">
																			Products</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://developer.xilinx.com/">
																			Developers</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/support.html">
																			Support</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/about/company-overview.html">
																			About</a>
																		</li>
																	</ul>
																</div>
															</div>
															<script type="text/javascript" src="_static/js/gtm.js"></script>
															<!--<div class="mini-nav">
																<button type="button" data-function="xilinx-mobile-menu" id="nav-toggle" class="navbar-toggle collapsed visible-xs-block" aria-expanded="false">
																<span></span>
																<span></span>
																<span></span>
																<span></span>
																</button>
																<ul class="list-inline">
																	<li class="dropdown user-menu">
																		<button data-toggle="dropdown">
																		<span class="sr-only">Account</span>
																		<span class="fas fa-user"></span>
																		</button>
																		<ul class="dropdown-menu">
																			<li>
																				<a href="https://www.xilinx.com/myprofile/subscriptions.html">
																				My Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/registration/create-account.html">
																				Create Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/bin/protected/en/signout">
																				Sign Out</a>
																			</li>
																		</ul>
																	</li>
																	<li class="hidden-xs">
																		<button data-function="search-toggle">
																		<span class="sr-only">Search</span>
																		<span class="far fa-search"></span>
																		</button>
																	</li>
																</ul>
															</div>
															-->
															<div class="search-container">
																<div id="headerSearchBox" class="headerSearch"
																	data-component="header-search"
																	data-redirect-if-empty="false"
																	data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																	data-coveo-organization-id="xilinxcomprode2rjoqok">
																	<div class='coveo-search-section'>
																		<div class="CoveoAnalytics" data-search-hub="Site"></div>
																		<ul class="dropdown-menu options">
																			<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																				<a href="#">
																				All</a>
																			</li>
																			<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com/products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Silicon Devices</a>
																			</li>
																			<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com/products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Boards and Kits</a>
																			</li>
																			<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com/products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Intellectual Property</a>
																			</li>
																			<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																				<a href="#">
																				Support</a>
																				<ul>
																					<li data-label="Documentation" data-action-link="https://www.xilinx.com/support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																						<a href="#">
																						Documentation</a>
																					</li>
																					<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com/support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																						<a href="#">
																						Knowledge Base</a>
																					</li>
																					<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																						<a href="#">
																						Community Forums</a>
																					</li>
																				</ul>
																			</li>
																			<li data-label="Partners" data-action-link="https://www.xilinx.com/alliance/member-keyword-search.html" data-search-hub="Partner">
																				<a href="#">
																				Partners</a>
																			</li>
																			<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																				<a href="#">
																				Videos</a>
																			</li>
																			<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																				<a href="#">
																				Press</a>
																			</li>
																		</ul>
																		<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																		<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																	</div>
																</div>
																<button data-function="search-toggle">
																<span class="sr-only">Search</span>
																<span class="far fa-times"></span>
																</button>
															</div>
														</div>
													</div>
												</div>
											</div>
										</nav>
									</header>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Vitis Vision Library
          

          
          </a>

          
            
            
              <div class="version">
                2021.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

      
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
            
            
              
            
            
              <p class="caption"><span class="caption-text">Vitis Vision Library User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html#getting-started-with-vitis-vision">Getting Started with Vitis Vision</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html#getting-started-with-hls">Getting Started with HLS</a></li>
<li class="toctree-l1"><a class="reference internal" href="overview.html#design-examples-using-vitis-vision-library">Design Examples Using Vitis Vision Library</a></li>
</ul>
<p class="caption"><span class="caption-text">Vitis Vision AIE Library User Guide</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#basic-features">Basic Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vitis-vision-aie-library-contents">Vitis Vision AIE Library Contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#getting-started-with-vitis-vision-aie">Getting Started with Vitis Vision AIE</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#aie-prerequisites">AIE Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#vitis-aie-design-methodology">Vitis AIE Design Methodology</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prepare-the-kernels">Prepare the Kernels</a></li>
<li class="toctree-l3"><a class="reference internal" href="#data-flow-graph-construction">Data Flow Graph construction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#setting-up-platform-ports">Setting up platform ports</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#fileio">FileIO</a></li>
<li class="toctree-l4"><a class="reference internal" href="#plio">PLIO</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gmio">GMIO</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#host-code-integration">Host code integration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#x86simulation-aie-simulation">x86Simulation / AIE simulation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hw-emulation-hw-run">HW emulation / HW run</a></li>
<li class="toctree-l4"><a class="reference internal" href="#xfcvdatamovers">xfcvDataMovers</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#evaluating-the-functionality">Evaluating the Functionality</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#x86-simulation">x86 Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#aie-simulation">AIE Simulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hw-emulation">HW emulation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testing-on-hw">Testing on HW</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#design-example-using-vitis-vision-aie-library">Design example Using Vitis Vision AIE Library</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#adf-graph">ADF Graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="#platform-ports">Platform Ports</a></li>
<li class="toctree-l2"><a class="reference internal" href="#host-code">Host code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#makefile">Makefile</a></li>
<li class="toctree-l2"><a class="reference internal" href="#filter2d-pipeline-on-multiple-aie-cores">Filter2D Pipeline on Multiple AIE Cores</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#executable-usage">Executable Usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="#performance">Performance</a><ul class="simple">
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Vitis Vision Library API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api-reference.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-reference.html#xf-cv-mat-image-container-class">xf::cv::Mat Image Container Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-reference.html#vitis-vision-library-functions">Vitis Vision Library Functions</a></li>
</ul>
<p class="caption"><span class="caption-text">Vitis Vision AIE Library API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api-reference-aie.html">xfcvDataMovers</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-reference-aie.html#vitis-vision-aie-library-functions-api-list-with-performance-estimates">Vitis Vision AIE Library Functions API list with performance estimates</a></li>
</ul>
<p class="caption"><span class="caption-text">Benchmark</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Benchmark.html">Benchmark</a></li>
</ul>
<p class="caption"><span class="caption-text">Release Notes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="releasenotesxfopencv.html">Release notes</a></li>
</ul>

            
			
			<p class="caption"><span class="caption-text">This Page</span></p>
				<ul class="current">
				  <li class="toctree-l1"><a href="_sources/overview-aie.rst.txt"
						rel="nofollow">Show Source</a></li>
				</ul>
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Vitis Vision Library</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Overview</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/overview-aie.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="overview">
<span id="overview-aie"></span><h1>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h1>
<p>In the 2021.1 release, Vitis Vision library has added few functions which are implemented on <cite>AI Engine™</cite> of Xilinx ACAP Versal devices and validated on <a class="reference external" href="https://www.xilinx.com/products/boards-and-kits/vck190.html">VCK190</a> boards. These implementations exploit the VLIW, SIMD vector processing capabilities of <a class="reference external" href="https://www.xilinx.com/products/technology/ai-engine.html">AI Engine™</a> .</p>
<div class="section" id="basic-features">
<span id="basic-features-aie"></span><h2>Basic Features<a class="headerlink" href="#basic-features" title="Permalink to this headline">¶</a></h2>
<p>To process high resolution images, xfcvDataMovers component is also provided which divides the image into tiled-units and uses efficient data-movers to manage the transfer of tiled-units to and from AIEngine™ cores. You can find more information on the types of data-movers and their usage, in the <span class="xref std std-ref">Getting Started with Vitis Vision AIEngine Library Functions</span> section.</p>
</div>
<div class="section" id="vitis-vision-aie-library-contents">
<h2>Vitis Vision AIE Library Contents<a class="headerlink" href="#vitis-vision-aie-library-contents" title="Permalink to this headline">¶</a></h2>
<p>Vitis Vision AIEngine™ files are organized into the following directories:</p>
<table border="1" class="docutils" id="id6">
<caption><span class="caption-text">Table Vitis Vision AIE Library Contents</span><a class="headerlink" href="#id6" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="38%" />
<col width="62%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Folder</th>
<th class="head">Details</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>L1/include/aie/imgproc</td>
<td>contains header files of vision AIEngine™ functions</td>
</tr>
<tr class="row-odd"><td>L1/include/aie/common</td>
<td>contains header files of data-movers and other utility functions</td>
</tr>
<tr class="row-even"><td>L1/lib/sw</td>
<td>contains the data-movers library object files</td>
</tr>
<tr class="row-odd"><td>L2/tests/aie</td>
<td>contains the ADF graph code and host-code using data-movers and vision AIEngine™ functions
from L1/include/aie</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="getting-started-with-vitis-vision-aie">
<h1>Getting Started with Vitis Vision AIE<a class="headerlink" href="#getting-started-with-vitis-vision-aie" title="Permalink to this headline">¶</a></h1>
<p>Describes the methodology to accelerate <a class="reference internal" href="api-reference-aie.html#aie-library-functions"><span class="std std-ref">Vitis Vision AIE library functions</span></a> on Versal adaptive compute acceleration platforms (ACAPs). This includes creation of Adaptive Data Flow (ADF) Graphs, setting up virtual platform and writing corresponding host code. It also covers various verification models including <a class="reference internal" href="#x86-simulation"><span class="std std-ref">x86 based simuation</span></a>, <a class="reference internal" href="#aie-simulation"><span class="std std-ref">cycle accurate AIE simulation</span></a>, <a class="reference internal" href="#hw-emulation"><span class="std std-ref">HW emulation</span></a> and <span class="xref std std-ref">HW run</span> methods using a suitable <a class="reference internal" href="#aie-makefile"><span class="std std-ref">Makefile</span></a>.</p>
<div class="section" id="aie-prerequisites">
<span id="id1"></span><h2>AIE Prerequisites<a class="headerlink" href="#aie-prerequisites" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Valid installation of Vitis™ 2021.2 or later version and the
corresponding licenses.</li>
<li>Install the Vitis Vision libraries, if you intend to use libraries
compiled differently than what is provided in Vitis.</li>
<li>Install the card for which the platform is supported in Vitis 2021.2 or
later versions.</li>
<li>If targeting an embedded platform, set up the evaluation board.</li>
<li>Xilinx® Runtime (XRT) must be installed. XRT provides software
interface to Xilinx FPGAs.</li>
<li>Install/compile OpenCV libraries(with compatible libjpeg.so).
Appropriate version (X86/aarch32/aarch64) of compiler must be used based
on the available processor for the target board.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All <a class="reference internal" href="api-reference-aie.html#aie-library-functions"><span class="std std-ref">Vitis Vision AIE library functions</span></a> were tested against OpenCV version - 4.4.0</p>
</div>
</div>
<div class="section" id="vitis-aie-design-methodology">
<h2>Vitis AIE Design Methodology<a class="headerlink" href="#vitis-aie-design-methodology" title="Permalink to this headline">¶</a></h2>
<p>Following are critical components in making a kernel work on a platform using Vitis™:</p>
<ol class="arabic simple">
<li>Prepare the Kernels</li>
<li>Data Flow Graph construction</li>
<li>Setting up platform ports</li>
<li>Host code integration</li>
<li>Makefile to compile the kernel for x86 simulation / aie simulation / hw-emulation / hw runs</li>
</ol>
<div class="section" id="prepare-the-kernels">
<h3>Prepare the Kernels<a class="headerlink" href="#prepare-the-kernels" title="Permalink to this headline">¶</a></h3>
<p>Kernels are computation functions that form the fundamental building blocks of the data flow graph specifications. Kernels are declared as ordinary C/C++ functions that return void and can use special data types as arguments (discussed in <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/window_streaming_api.html#efv1509388613160">Window and Streaming Data API</a>). Each kernel should be defined in its own source file. This organization is recommended for reusable and faster compilation. Furthermore, the kernel source files should include all relevant header files to allow for independent compilation. It is recommended that a header file (kernels.h in this documentation) should declare the function prototypes for all kernels used in a graph. An example is shown below.</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#ifndef _KERNELS_16B_H_</span>
<span class="c1">#define _KERNELS_16B_H_</span>

<span class="c1">#include &lt;adf/stream/types.h&gt;</span>
<span class="c1">#include &lt;adf/window/types.h&gt;</span>
<span class="c1">#include &lt;stdint.h&gt;</span>
<span class="c1">#include &lt;stdio.h&gt;</span>
<span class="c1">#include &lt;stdlib.h&gt;</span>

<span class="c1">#define PARALLEL_FACTOR_16b 16 // Parallelization factor for 16b operations (16x mults)</span>
<span class="c1">#define SRS_SHIFT 10           // SRS shift used can be increased if input data likewise adjusted)</span>

<span class="n">void</span> <span class="n">filter2D</span><span class="p">(</span><span class="n">input_window_int16</span><span class="o">*</span> <span class="nb">input</span><span class="p">,</span> <span class="n">const</span> <span class="n">int16_t</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">coeff</span><span class="p">)[</span><span class="mi">16</span><span class="p">],</span> <span class="n">output_window_int16</span><span class="o">*</span> <span class="n">output</span><span class="p">);</span>

<span class="c1">#endif</span>
</pre></div>
</div>
<p><a class="reference internal" href="api-reference-aie.html#aie-library-functions"><span class="std std-ref">Vitis Vision AIE library functions</span></a> packaged with Vitis Vision AIE library are pre optimized vector implementations for various computer vision tasks. These functions can be directly included in user kernel (as shown in example below)</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &quot;imgproc/xf_filter2d_16b_aie.hpp&quot;</span>
<span class="c1">#include &quot;kernels.h&quot;</span>

<span class="n">void</span> <span class="n">filter2D</span><span class="p">(</span><span class="n">input_window_int16</span><span class="o">*</span> <span class="nb">input</span><span class="p">,</span> <span class="n">const</span> <span class="n">int16_t</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">coeff</span><span class="p">)[</span><span class="mi">16</span><span class="p">],</span> <span class="n">output_window_int16</span><span class="o">*</span> <span class="n">output</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">xf</span><span class="p">::</span><span class="n">cv</span><span class="p">::</span><span class="n">aie</span><span class="p">::</span><span class="n">filter2D_k3_border</span><span class="p">(</span><span class="nb">input</span><span class="p">,</span> <span class="n">coeff</span><span class="p">,</span> <span class="n">output</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="data-flow-graph-construction">
<h3>Data Flow Graph construction<a class="headerlink" href="#data-flow-graph-construction" title="Permalink to this headline">¶</a></h3>
<p>Once AIE kernels have been prepared, next step is to create a Data Flow Graph class which defines the top level ports, <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/runtime_graph_api.html#xpw1512590673863">Run time parameters</a>, connectivity, constraints etc. This consists of below steps</p>
<ol class="arabic">
<li><p class="first">Create graph.h and include Adaptive Data Flow (ADF) header file (adf.h). Also include header file with kernel function prototypes (kernel.h)</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;adf.h&gt;</span>
<span class="c1">#include &quot;kernels.h&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first">Define your graph class by using the objects which are defined in the adf name space. All user graphs are derived from the class graph.</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">include</span> <span class="o">&lt;</span><span class="n">adf</span><span class="o">.</span><span class="n">h</span><span class="o">&gt;</span>
<span class="c1">#include &quot;kernels.h&quot;</span>

<span class="n">using</span> <span class="n">namespace</span> <span class="n">adf</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">myGraph</span> <span class="p">:</span> <span class="n">public</span> <span class="n">graph</span> <span class="p">{</span>
<span class="n">private</span><span class="p">:</span>
    <span class="n">kernel</span> <span class="n">k1</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</li>
<li><p class="first">Add top level ports to graph. These ports will be responsible to data transfers to / from the kernels.</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &lt;adf.h&gt;</span>
<span class="c1">#include &quot;kernels.h&quot;</span>

<span class="n">using</span> <span class="n">namespace</span> <span class="n">adf</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">simpleGraph</span> <span class="p">:</span> <span class="n">public</span> <span class="n">graph</span> <span class="p">{</span>
<span class="n">private</span><span class="p">:</span>
    <span class="n">kernel</span> <span class="n">k1</span><span class="p">;</span>

<span class="n">public</span><span class="p">:</span>
    <span class="n">port</span><span class="o">&lt;</span><span class="nb">input</span><span class="o">&gt;</span> <span class="n">inptr</span><span class="p">;</span>
    <span class="n">port</span><span class="o">&lt;</span><span class="n">output</span><span class="o">&gt;</span> <span class="n">outptr</span><span class="p">;</span>
    <span class="n">port</span><span class="o">&lt;</span><span class="nb">input</span><span class="o">&gt;</span> <span class="n">kernelCoefficients</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</li>
<li><p class="first">Specify connections of top level ports to kernels. Primary connections type are <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/window_streaming_api.html#iii1512524581327">Window</a>, <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/window_streaming_api.html#xta1512524637575">Stream</a>, <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/runtime_graph_api.html#xpw1512590673863">Run time parameters</a>. Below is example code specifying connectivity.</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">myGraph</span> <span class="p">:</span> <span class="n">public</span> <span class="n">adf</span><span class="p">::</span><span class="n">graph</span> <span class="p">{</span>
<span class="n">private</span><span class="p">:</span>
    <span class="n">kernel</span> <span class="n">k1</span><span class="p">;</span>
<span class="n">public</span><span class="p">:</span>
    <span class="n">port</span><span class="o">&lt;</span><span class="nb">input</span><span class="o">&gt;</span> <span class="n">inptr</span><span class="p">;</span>
    <span class="n">port</span><span class="o">&lt;</span><span class="n">output</span><span class="o">&gt;</span> <span class="n">outptr</span><span class="p">;</span>
    <span class="n">port</span><span class="o">&lt;</span><span class="nb">input</span><span class="o">&gt;</span> <span class="n">kernelCoefficients</span><span class="p">;</span>

    <span class="n">myGraph</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">k1</span> <span class="o">=</span> <span class="n">kernel</span><span class="p">::</span><span class="n">create</span><span class="p">(</span><span class="n">filter2D</span><span class="p">);</span>
        <span class="n">adf</span><span class="p">::</span><span class="n">connect</span><span class="o">&lt;</span><span class="n">window</span><span class="o">&lt;</span><span class="n">TILE_WINDOW_SIZE</span><span class="o">&gt;</span> <span class="o">&gt;</span><span class="p">(</span><span class="n">inptr</span><span class="p">,</span> <span class="n">k1</span><span class="o">.</span><span class="ow">in</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="n">adf</span><span class="p">::</span><span class="n">connect</span><span class="o">&lt;</span><span class="n">parameter</span><span class="o">&gt;</span><span class="p">(</span><span class="n">kernelCoefficients</span><span class="p">,</span> <span class="k">async</span><span class="p">(</span><span class="n">k1</span><span class="o">.</span><span class="ow">in</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>
        <span class="n">adf</span><span class="p">::</span><span class="n">connect</span><span class="o">&lt;</span><span class="n">window</span><span class="o">&lt;</span><span class="n">TILE_WINDOW_SIZE</span><span class="o">&gt;</span> <span class="o">&gt;</span><span class="p">(</span><span class="n">k1</span><span class="o">.</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">outptr</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
</li>
<li><p class="first">Specify source file location and other constraints for each kernel</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">myGraph</span> <span class="p">:</span> <span class="n">public</span> <span class="n">adf</span><span class="p">::</span><span class="n">graph</span> <span class="p">{</span>
<span class="n">private</span><span class="p">:</span>
    <span class="n">kernel</span> <span class="n">k1</span><span class="p">;</span>
<span class="n">public</span><span class="p">:</span>
    <span class="n">port</span><span class="o">&lt;</span><span class="nb">input</span><span class="o">&gt;</span> <span class="n">inptr</span><span class="p">;</span>
    <span class="n">port</span><span class="o">&lt;</span><span class="n">output</span><span class="o">&gt;</span> <span class="n">outptr</span><span class="p">;</span>
    <span class="n">port</span><span class="o">&lt;</span><span class="nb">input</span><span class="o">&gt;</span> <span class="n">kernelCoefficients</span><span class="p">;</span>

    <span class="n">myGraph</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">k1</span> <span class="o">=</span> <span class="n">kernel</span><span class="p">::</span><span class="n">create</span><span class="p">(</span><span class="n">filter2D</span><span class="p">);</span>
        <span class="n">adf</span><span class="p">::</span><span class="n">connect</span><span class="o">&lt;</span><span class="n">window</span><span class="o">&lt;</span><span class="n">TILE_WINDOW_SIZE</span><span class="o">&gt;</span> <span class="o">&gt;</span><span class="p">(</span><span class="n">inptr</span><span class="p">,</span> <span class="n">k1</span><span class="o">.</span><span class="ow">in</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="n">adf</span><span class="p">::</span><span class="n">connect</span><span class="o">&lt;</span><span class="n">parameter</span><span class="o">&gt;</span><span class="p">(</span><span class="n">kernelCoefficients</span><span class="p">,</span> <span class="k">async</span><span class="p">(</span><span class="n">k1</span><span class="o">.</span><span class="ow">in</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>
        <span class="n">adf</span><span class="p">::</span><span class="n">connect</span><span class="o">&lt;</span><span class="n">window</span><span class="o">&lt;</span><span class="n">TILE_WINDOW_SIZE</span><span class="o">&gt;</span> <span class="o">&gt;</span><span class="p">(</span><span class="n">k1</span><span class="o">.</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">outptr</span><span class="p">);</span>
        <span class="n">source</span><span class="p">(</span><span class="n">k1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;xf_filter2d.cc&quot;</span><span class="p">;</span>
        <span class="o">//</span> <span class="n">Initial</span> <span class="n">mapping</span>
        <span class="n">runtime</span><span class="o">&lt;</span><span class="n">ratio</span><span class="o">&gt;</span><span class="p">(</span><span class="n">k1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="setting-up-platform-ports">
<h3>Setting up platform ports<a class="headerlink" href="#setting-up-platform-ports" title="Permalink to this headline">¶</a></h3>
<p>Next step is to create a graph.cpp file with platform ports and virtual platform specification. A virtual platform specification helps to connect the data flow graph written with external I/O mechanisms specific to the chosen target for testing or eventual deployment. The platform could be specified for a simulation, emulation, or an actual hardware execution target.</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">simulation</span><span class="p">::</span><span class="n">platform</span><span class="o">&lt;</span><span class="n">inputs</span><span class="p">,</span> <span class="n">outputs</span><span class="o">&gt;</span> <span class="n">platform_name</span><span class="p">(</span><span class="n">port_attribute_list</span><span class="p">);</span>
</pre></div>
</div>
<p>There are 3 types of platform ports attributes which describe how data is transferred to / from AIE cores.</p>
<div class="section" id="fileio">
<span id="fileio-aie"></span><h4>FileIO<a class="headerlink" href="#fileio" title="Permalink to this headline">¶</a></h4>
<p>By default, a platform port attribute is a string name used to construct an attribute of type FileIO. The string specifies the name of an input or output file relative to the current directory that will source or sink the platform data. The explicit form is specified in the following example using a FileIO constructor.</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FileIO</span><span class="o">*</span> <span class="ow">in</span> <span class="o">=</span> <span class="n">new</span> <span class="n">FileIO</span><span class="p">(</span><span class="n">input_file_name</span><span class="p">);</span>
<span class="n">FileIO</span><span class="o">*</span> <span class="n">out</span> <span class="o">=</span> <span class="n">new</span> <span class="n">FileIO</span><span class="p">(</span><span class="n">output_file_name</span><span class="p">);</span>
<span class="n">simulation</span><span class="p">::</span><span class="n">platform</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">&gt;</span> <span class="n">plat</span><span class="p">(</span><span class="ow">in</span><span class="p">,</span><span class="n">out</span><span class="p">);</span>
</pre></div>
</div>
<p>FileIO ports are solely for the purpose of application simulation in the absence of an actual hardware platform. They are provided as a matter of convenience to test out a data flow graph in isolation before it is connected to a real platform. An actual hardware platform exports either stream or memory ports.</p>
</div>
<div class="section" id="plio">
<span id="plio-aie"></span><h4>PLIO<a class="headerlink" href="#plio" title="Permalink to this headline">¶</a></h4>
<p>A PLIO port attribute is used to make external stream connections that cross the AI Engine to programmable logic (PL) boundary. The following example shows how the PLIO attributes shown in the previous table can be used in a program to read input data from a file or write output data to a file. The PLIO width and frequency of the PLIO port are also provided in the PLIO constructor. For more details please refer <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/use_virtual_program.html#bna1512607665307">PLIO Attributes</a>.</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">Virtual</span> <span class="n">platform</span> <span class="n">ports</span>
<span class="n">PLIO</span><span class="o">*</span> <span class="n">in1</span> <span class="o">=</span> <span class="n">new</span> <span class="n">PLIO</span><span class="p">(</span><span class="s2">&quot;DataIn1&quot;</span><span class="p">,</span> <span class="n">adf</span><span class="p">::</span><span class="n">plio_64_bits</span><span class="p">,</span> <span class="s2">&quot;data/input.txt&quot;</span><span class="p">);</span>
<span class="n">PLIO</span><span class="o">*</span> <span class="n">out1</span> <span class="o">=</span> <span class="n">new</span> <span class="n">PLIO</span><span class="p">(</span><span class="s2">&quot;DataOut1&quot;</span><span class="p">,</span> <span class="n">adf</span><span class="p">::</span><span class="n">plio_64_bits</span><span class="p">,</span> <span class="s2">&quot;data/output.txt&quot;</span><span class="p">);</span>
<span class="n">simulation</span><span class="p">::</span><span class="n">platform</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">&gt;</span> <span class="n">platform</span><span class="p">(</span><span class="n">in1</span><span class="p">,</span><span class="n">out1</span><span class="p">);</span>

<span class="o">//</span><span class="n">Graph</span> <span class="nb">object</span>
<span class="n">myGraph</span> <span class="n">filter_graph</span><span class="p">;</span>

<span class="o">//</span><span class="n">Virtual</span> <span class="n">platform</span> <span class="n">connectivity</span>
<span class="n">connect</span><span class="o">&lt;&gt;</span> <span class="n">net0</span><span class="p">(</span><span class="n">platform</span><span class="o">.</span><span class="n">src</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">filter_graph</span><span class="o">.</span><span class="n">inptr</span><span class="p">);</span>
<span class="n">connect</span><span class="o">&lt;&gt;</span> <span class="n">net1</span><span class="p">(</span><span class="n">filter_graph</span><span class="o">.</span><span class="n">outptr</span><span class="p">,</span> <span class="n">platform</span><span class="o">.</span><span class="n">sink</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="gmio">
<span id="gmio-aie"></span><h4>GMIO<a class="headerlink" href="#gmio" title="Permalink to this headline">¶</a></h4>
<p>A GMIO port attribute is used to make external memory-mapped connections to or from the global memory. These connections are made between an AI Engine graph and the logical global memory ports of a hardware platform design. For more details please refer <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/use_virtual_program.html#pxw1512607606711">GMIO Attributes</a>.</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GMIO</span> <span class="n">gmioIn1</span><span class="p">(</span><span class="s2">&quot;gmioIn1&quot;</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
<span class="n">GMIO</span> <span class="n">gmioOut</span><span class="p">(</span><span class="s2">&quot;gmioOut&quot;</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
<span class="n">simulation</span><span class="p">::</span><span class="n">platform</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">&gt;</span> <span class="n">platform</span><span class="p">(</span><span class="o">&amp;</span><span class="n">gmioIn1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">gmioOut</span><span class="p">);</span>

<span class="n">myGraph</span> <span class="n">filter_graph</span><span class="p">;</span>

<span class="n">connect</span><span class="o">&lt;&gt;</span> <span class="n">net0</span><span class="p">(</span><span class="n">platform</span><span class="o">.</span><span class="n">src</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">filter_graph</span><span class="o">.</span><span class="n">in1</span><span class="p">);</span>
<span class="n">connect</span><span class="o">&lt;&gt;</span> <span class="n">net1</span><span class="p">(</span><span class="n">filter_graph</span><span class="o">.</span><span class="n">out1</span><span class="p">,</span> <span class="n">platform</span><span class="o">.</span><span class="n">sink</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="host-code-integration">
<h3>Host code integration<a class="headerlink" href="#host-code-integration" title="Permalink to this headline">¶</a></h3>
<p>Depending upon the functional verification model used, the top level application can be written using on of 2 ways.</p>
<div class="section" id="x86simulation-aie-simulation">
<h4>x86Simulation / AIE simulation<a class="headerlink" href="#x86simulation-aie-simulation" title="Permalink to this headline">¶</a></h4>
<p>In this mode the top level application can be written inside graph.cpp file. The application contains an instance of ADF graph and a main function within which API’s are called to initialize, run and end the graph. It may also have additional API’s to update <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/runtime_graph_api.html#xpw1512590673863">Run time parameters</a>. Additionally for hw emulation / hw run modes, the ‘main()’ function can be guarded by a #ifdef to ensure graph is only initialized once, or run only once. The following example code is the simple application defined in <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/ai_engine_programming.html#tzk1513812699928">Creating a Data Flow Graph (Including Kernels)</a> with the additional guard macro __AIESIM__ and __X86SIM__.</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span> <span class="n">Virtual</span> <span class="n">platform</span> <span class="n">ports</span>
<span class="n">PLIO</span><span class="o">*</span> <span class="n">in1</span> <span class="o">=</span> <span class="n">new</span> <span class="n">PLIO</span><span class="p">(</span><span class="s2">&quot;DataIn1&quot;</span><span class="p">,</span> <span class="n">adf</span><span class="p">::</span><span class="n">plio_64_bits</span><span class="p">,</span> <span class="s2">&quot;data/input.txt&quot;</span><span class="p">);</span>
<span class="n">PLIO</span><span class="o">*</span> <span class="n">out1</span> <span class="o">=</span> <span class="n">new</span> <span class="n">PLIO</span><span class="p">(</span><span class="s2">&quot;DataOut1&quot;</span><span class="p">,</span> <span class="n">adf</span><span class="p">::</span><span class="n">plio_64_bits</span><span class="p">,</span> <span class="s2">&quot;data/output.txt&quot;</span><span class="p">);</span>
<span class="n">simulation</span><span class="p">::</span><span class="n">platform</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">&gt;</span> <span class="n">platform</span><span class="p">(</span><span class="n">in1</span><span class="p">,</span> <span class="n">out1</span><span class="p">);</span>

<span class="o">//</span> <span class="n">Graph</span> <span class="nb">object</span>
<span class="n">myGraph</span> <span class="n">filter_graph</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Virtual</span> <span class="n">platform</span> <span class="n">connectivity</span>
<span class="n">connect</span><span class="o">&lt;&gt;</span> <span class="n">net0</span><span class="p">(</span><span class="n">platform</span><span class="o">.</span><span class="n">src</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">filter_graph</span><span class="o">.</span><span class="n">inptr</span><span class="p">);</span>
<span class="n">connect</span><span class="o">&lt;&gt;</span> <span class="n">net1</span><span class="p">(</span><span class="n">filter_graph</span><span class="o">.</span><span class="n">outptr</span><span class="p">,</span> <span class="n">platform</span><span class="o">.</span><span class="n">sink</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

<span class="c1">#define SRS_SHIFT 10</span>
<span class="nb">float</span> <span class="n">kData</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mf">0.0625</span><span class="p">,</span> <span class="mf">0.1250</span><span class="p">,</span> <span class="mf">0.0625</span><span class="p">,</span> <span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.0625</span><span class="p">,</span> <span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.0625</span><span class="p">};</span>


<span class="c1">#if defined(__AIESIM__) || defined(__X86SIM__)</span>
<span class="nb">int</span> <span class="n">main</span><span class="p">(</span><span class="nb">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">filter_graph</span><span class="o">.</span><span class="n">init</span><span class="p">();</span>
    <span class="n">filter_graph</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">filter_graph</span><span class="o">.</span><span class="n">kernelCoefficients</span><span class="p">,</span> <span class="n">float2fixed_coeff</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">,</span> <span class="mi">16</span><span class="o">&gt;</span><span class="p">(</span><span class="n">kData</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">(),</span> <span class="mi">16</span><span class="p">);</span>
    <span class="n">filter_graph</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="n">filter_graph</span><span class="o">.</span><span class="n">end</span><span class="p">();</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">#endif</span>
</pre></div>
</div>
<p>In case GMIO based ports are used</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#if defined(__AIESIM__) || defined(__X86SIM__)</span>
<span class="nb">int</span> <span class="n">main</span><span class="p">(</span><span class="nb">int</span> <span class="n">argc</span><span class="p">,</span> <span class="n">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="o">...</span>
    <span class="o">...</span>
    <span class="n">int16_t</span><span class="o">*</span> <span class="n">inputData</span> <span class="o">=</span> <span class="p">(</span><span class="n">int16_t</span><span class="o">*</span><span class="p">)</span><span class="n">GMIO</span><span class="p">::</span><span class="n">malloc</span><span class="p">(</span><span class="n">BLOCK_SIZE_in_Bytes</span><span class="p">);</span>
    <span class="n">int16_t</span><span class="o">*</span> <span class="n">outputData</span> <span class="o">=</span> <span class="p">(</span><span class="n">int16_t</span><span class="o">*</span><span class="p">)</span><span class="n">GMIO</span><span class="p">::</span><span class="n">malloc</span><span class="p">(</span><span class="n">BLOCK_SIZE_in_Bytes</span><span class="p">);</span>

    <span class="o">//</span><span class="n">Prepare</span> <span class="nb">input</span> <span class="n">data</span>
    <span class="o">...</span>
    <span class="o">...</span>

    <span class="n">filter_graph</span><span class="o">.</span><span class="n">init</span><span class="p">();</span>
    <span class="n">filter_graph</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">filter_graph</span><span class="o">.</span><span class="n">kernelCoefficients</span><span class="p">,</span> <span class="n">float2fixed_coeff</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">,</span> <span class="mi">16</span><span class="o">&gt;</span><span class="p">(</span><span class="n">kData</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">(),</span> <span class="mi">16</span><span class="p">);</span>

    <span class="n">filter_graph</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="o">//</span><span class="n">GMIO</span> <span class="n">Data</span> <span class="n">transfer</span> <span class="n">calls</span>
    <span class="n">gmioIn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">gm2aie_nb</span><span class="p">(</span><span class="n">inputData</span><span class="p">,</span> <span class="n">BLOCK_SIZE_in_Bytes</span><span class="p">);</span>
    <span class="n">gmioOut</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">aie2gm_nb</span><span class="p">(</span><span class="n">outputData</span><span class="p">,</span> <span class="n">BLOCK_SIZE_in_Bytes</span><span class="p">);</span>
    <span class="n">gmioOut</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">wait</span><span class="p">();</span>

    <span class="n">printf</span><span class="p">(</span><span class="s2">&quot;after grph wait</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">);</span>
    <span class="n">filter_graph</span><span class="o">.</span><span class="n">end</span><span class="p">();</span>

    <span class="o">...</span>
<span class="p">}</span>
<span class="c1">#endif</span>
</pre></div>
</div>
</div>
<div class="section" id="hw-emulation-hw-run">
<h4>HW emulation / HW run<a class="headerlink" href="#hw-emulation-hw-run" title="Permalink to this headline">¶</a></h4>
<p>For x86Simulation / AIE simulation, top level application had simple ADF API calls to initialize / run / end the graph. However, for actual AI Engine graph applications the host code must do much more than those simple tasks. The top-level PS application running on the Cortex®-A72, controls the graph and PL kernels: manage data inputs to the graph, handle data outputs from the graph, and control any PL kernels working with the graph. Sample code is illustrated below</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">1.</span><span class="o">//</span> <span class="n">Open</span> <span class="n">device</span><span class="p">,</span> <span class="n">load</span> <span class="n">xclbin</span><span class="p">,</span> <span class="ow">and</span> <span class="n">get</span> <span class="n">uuid</span>

<span class="n">auto</span> <span class="n">dhdl</span> <span class="o">=</span> <span class="n">xrtDeviceOpen</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="o">//</span><span class="n">device</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span>

<span class="n">xrtDeviceLoadXclbinFile</span><span class="p">(</span><span class="n">dhdl</span><span class="p">,</span><span class="n">xclbinFilename</span><span class="p">);</span>
<span class="n">xuid_t</span> <span class="n">uuid</span><span class="p">;</span>
<span class="n">xrtDeviceGetXclbinUUID</span><span class="p">(</span><span class="n">dhdl</span><span class="p">,</span> <span class="n">uuid</span><span class="p">);</span>
<span class="n">adf</span><span class="p">::</span><span class="n">registerXRT</span><span class="p">(</span><span class="n">dhdl</span><span class="p">,</span> <span class="n">uuid</span><span class="p">);</span>

<span class="mf">2.</span> <span class="n">Allocate</span> <span class="n">output</span> <span class="n">buffer</span> <span class="n">objects</span> <span class="ow">and</span> <span class="nb">map</span> <span class="n">to</span> <span class="n">host</span> <span class="n">memory</span>

<span class="n">xrtBufferHandle</span> <span class="n">out_bohdl</span> <span class="o">=</span> <span class="n">xrtBOAlloc</span><span class="p">(</span><span class="n">dhdl</span><span class="p">,</span> <span class="n">output_size_in_bytes</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">/*</span><span class="n">BANK</span><span class="o">=*/</span><span class="mi">0</span><span class="p">);</span>
<span class="n">std</span><span class="p">::</span><span class="nb">complex</span><span class="o">&lt;</span><span class="n">short</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">host_out</span> <span class="o">=</span> <span class="p">(</span><span class="n">std</span><span class="p">::</span><span class="nb">complex</span><span class="o">&lt;</span><span class="n">short</span><span class="o">&gt;*</span><span class="p">)</span><span class="n">xrtBOMap</span><span class="p">(</span><span class="n">out_bohdl</span><span class="p">);</span>

<span class="mf">3.</span> <span class="n">Get</span> <span class="n">kernel</span> <span class="ow">and</span> <span class="n">run</span> <span class="n">handles</span><span class="p">,</span> <span class="nb">set</span> <span class="n">arguments</span> <span class="k">for</span> <span class="n">kernel</span><span class="p">,</span> <span class="ow">and</span> <span class="n">launch</span> <span class="n">kernel</span><span class="o">.</span>
<span class="n">xrtKernelHandle</span> <span class="n">s2mm_khdl</span> <span class="o">=</span> <span class="n">xrtPLKernelOpen</span><span class="p">(</span><span class="n">dhdl</span><span class="p">,</span> <span class="n">top</span><span class="o">-&gt;</span><span class="n">m_header</span><span class="o">.</span><span class="n">uuid</span><span class="p">,</span> <span class="s2">&quot;s2mm&quot;</span><span class="p">);</span> <span class="o">//</span> <span class="n">Open</span> <span class="n">kernel</span> <span class="n">handle</span>
<span class="n">xrtRunHandle</span> <span class="n">s2mm_rhdl</span> <span class="o">=</span> <span class="n">xrtRunOpen</span><span class="p">(</span><span class="n">s2mm_khdl</span><span class="p">);</span>
<span class="n">xrtRunSetArg</span><span class="p">(</span><span class="n">s2mm_rhdl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">out_bohdl</span><span class="p">);</span> <span class="o">//</span> <span class="nb">set</span> <span class="n">kernel</span> <span class="n">arg</span>
<span class="n">xrtRunSetArg</span><span class="p">(</span><span class="n">s2mm_rhdl</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">OUTPUT_SIZE</span><span class="p">);</span> <span class="o">//</span> <span class="nb">set</span> <span class="n">kernel</span> <span class="n">arg</span>
<span class="n">xrtRunStart</span><span class="p">(</span><span class="n">s2mm_rhdl</span><span class="p">);</span> <span class="o">//</span><span class="n">launch</span> <span class="n">s2mm</span> <span class="n">kernel</span>

<span class="o">//</span> <span class="n">ADF</span> <span class="n">API</span><span class="p">:</span><span class="n">run</span><span class="p">,</span> <span class="n">update</span> <span class="n">graph</span> <span class="n">parameters</span> <span class="p">(</span><span class="n">RTP</span><span class="p">)</span> <span class="ow">and</span> <span class="n">so</span> <span class="n">on</span>
<span class="n">gr</span><span class="o">.</span><span class="n">init</span><span class="p">();</span>
<span class="n">gr</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">gr</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="mi">1024</span><span class="p">);</span><span class="o">//</span><span class="n">update</span> <span class="n">RTP</span>
<span class="n">gr</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="mi">16</span><span class="p">);</span><span class="o">//</span><span class="n">start</span> <span class="n">AIE</span> <span class="n">kernel</span>
<span class="n">gr</span><span class="o">.</span><span class="n">wait</span><span class="p">();</span>

<span class="mf">4.</span> <span class="n">Wait</span> <span class="k">for</span> <span class="n">kernel</span> <span class="n">completion</span><span class="o">.</span>
<span class="n">auto</span> <span class="n">state</span> <span class="o">=</span> <span class="n">xrtRunWait</span><span class="p">(</span><span class="n">s2mm_rhdl</span><span class="p">);</span>

<span class="mf">5.</span> <span class="n">Sync</span> <span class="n">output</span> <span class="n">device</span> <span class="n">buffer</span> <span class="n">objects</span> <span class="n">to</span> <span class="n">host</span> <span class="n">memory</span><span class="o">.</span>

<span class="n">xrtBOSync</span><span class="p">(</span><span class="n">out_bohdl</span><span class="p">,</span> <span class="n">XCL_BO_SYNC_BO_FROM_DEVICE</span> <span class="p">,</span> <span class="n">output_size_in_bytes</span><span class="p">,</span><span class="o">/*</span><span class="n">OFFSET</span><span class="o">=*/</span> <span class="mi">0</span><span class="p">);</span>

<span class="o">//</span><span class="mf">6.</span> <span class="n">post</span><span class="o">-</span><span class="n">processing</span> <span class="n">on</span> <span class="n">host</span> <span class="n">memory</span> <span class="o">-</span> <span class="s2">&quot;host_out</span>
</pre></div>
</div>
<p><a class="reference internal" href="api-reference-aie.html#aie-library-functions"><span class="std std-ref">Vitis Vision AIE library functions</span></a> provide optimal vector implementations of various computer vision algorithms. These functions are expected to process high resolution images. However because local memory of AIE core module is limited, entire image can’t be fit into it. Also accessing DDR for reading / writing image data will be highly inefficient both for performance and power. To overcome this limitation host code is expected to split the high resolution image into smaller tiles which fit in AIE Engine local memory in ping-pong fashion. Splitting of high resolution image in smaller tiles is a complex operation as it need to be aware of overlap regions and borders. Also the tile size is expected to be aligned with vectorization factor of the kernel.</p>
<p>To facilitate this Vitis Vision Library provides data movers which perform smart tiling / stitching of high resolution images which can meet all above requirements. There are two versions made available which can provide data movement capabilities both using PLIO and GMIO interfaces. A high level class abstraction is provided with simple API interface to facilitate data transfers. The class abstraction allows seamless transition between PLIO - GMIO methods of data transfers.</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last"><strong>For HW emulation / HW run it is imperative to include graph.cpp inside host.cpp. This is because platform port specification and ADF graph object instance is declared in graph.cpp.</strong></p>
</div>
</div>
<div class="section" id="xfcvdatamovers">
<span id="xfcvdatamovers-aie"></span><h4>xfcvDataMovers<a class="headerlink" href="#xfcvdatamovers" title="Permalink to this headline">¶</a></h4>
<p>xfcvDataMovers class provides a high level API abstraction to initiate data transfer from DDR to AIE core and vice versa for hw-emulation / hw runs. Because each AIE core has limited amount of local memory which is not sufficient to fit in entire high resolution images (input / output), each image needs to be partitioned into smaller tiles and then send to AIE core for computation. After computation the tiled image at output is stitched back to generate the high resolution image at the output. This process involves complex computation as tiling needs to ensure proper border handling and overlap processing in case of
convolution based kernels.</p>
<p>xfcvDataMovers class object takes input some simple parameters from users and provides a simple data transaction API where user does not have to bother about the complexity. Moreover it provides a template parameter using which application can switch from PL based data movement to GMIO based (and vice versa) seamlessly.</p>
<table border="1" class="colwidths-given docutils" id="id7">
<caption><span class="caption-text">Table. xfcvDataMovers Template Parameters</span><a class="headerlink" href="#id7" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Parameter</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>KIND</td>
<td>Type of object TILER / STITCHER</td>
</tr>
<tr class="row-odd"><td>DATA_TYPE</td>
<td>Data type of AIE core kernel input or output</td>
</tr>
<tr class="row-even"><td>TILE_HEIGHT_MAX</td>
<td>Maximum tile height</td>
</tr>
<tr class="row-odd"><td>TILE_WIDTH_MAX</td>
<td>Maximum tile width</td>
</tr>
<tr class="row-even"><td>AIE_VECTORIZATION_FACTOR</td>
<td>AIE core vectorization factor</td>
</tr>
<tr class="row-odd"><td>CORES</td>
<td>Number of AIE cores to be used. <em>Currently only 1 core is supported</em></td>
</tr>
<tr class="row-even"><td>PL_AXI_BITWIDTH</td>
<td>For PL based data movers. It is the data width for AXI transfers between DDR - PL</td>
</tr>
<tr class="row-odd"><td>USE_GMIO</td>
<td>Set to true to use GMIO based data transfer</td>
</tr>
</tbody>
</table>
<table border="1" class="colwidths-given docutils" id="id8">
<caption><span class="caption-text">Table. xfcvDataMovers constructor parameters</span><a class="headerlink" href="#id8" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Parameter</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>overlapH</td>
<td>Horizontal overlap of the AIE core / pipeline</td>
</tr>
<tr class="row-odd"><td>overlapV</td>
<td>Vertical overlap of the AIE core / pipeline</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Horizontal overlap and Vertical overlaps should be computed for the complete pipeline. For example if the pipeline has a single 3x3 2D filter then overlap sizes (both horizontal and vertical) will be 1. However in case of two such filter operations which are back to back the overlap size will be 2. Currently if it is expected from users to provide this input correctly.</p>
</div>
<p>The data transfer using xfcvDataMovers class can be done in one out of 2 ways.</p>
<ol class="arabic">
<li><p class="first">PLIO data movers</p>
<p>This is the default mode for xfcvDataMovers class operation. When this method is used, data is transferred using hardware Tiler / Stitcher IPs provided by Xilinx. The <a class="reference internal" href="#aie-makefile"><span class="std std-ref">Makefile</span></a> provided with designs examples shipped with the library provide location to .xo files for these IP’s. It also shows how to incorporate them in Vitis Build System. Having said that, user needs to create an object of xfcvDataMovers class per input / output image as shown in code below</p>
<div class="admonition important">
<p class="first admonition-title">Important</p>
<p class="last"><strong>The implementations of Tiler and Stitcher for PLIO, are provided as .xo files in ‘L1/lib/hw’ folder. By using these files, you are agreeing to the terms and conditions specified in the LICENSE.txt file available in the same directory.</strong></p>
</div>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">overlapH</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="nb">int</span> <span class="n">overlapV</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">xF</span><span class="p">::</span><span class="n">xfcvDataMovers</span><span class="o">&lt;</span><span class="n">xF</span><span class="p">::</span><span class="n">TILER</span><span class="p">,</span> <span class="n">int16_t</span><span class="p">,</span> <span class="n">MAX_TILE_HEIGHT</span><span class="p">,</span> <span class="n">MAX_TILE_WIDTH</span><span class="p">,</span> <span class="n">VECTORIZATION_FACTOR</span><span class="o">&gt;</span> <span class="n">tiler</span><span class="p">(</span><span class="n">overlapH</span><span class="p">,</span> <span class="n">overlapV</span><span class="p">);</span>
<span class="n">xF</span><span class="p">::</span><span class="n">xfcvDataMovers</span><span class="o">&lt;</span><span class="n">xF</span><span class="p">::</span><span class="n">STITCHER</span><span class="p">,</span> <span class="n">int16_t</span><span class="p">,</span> <span class="n">MAX_TILE_HEIGHT</span><span class="p">,</span> <span class="n">MAX_TILE_WIDTH</span><span class="p">,</span> <span class="n">VECTORIZATION_FACTOR</span><span class="o">&gt;</span> <span class="n">stitcher</span><span class="p">;</span>
</pre></div>
</div>
<p>Choice of MAX_TILE_HEIGHT / MAX_TILE_WIDTH provide constraints on image tile size which in turn governs local memory usage. The image tile size in bytes can be computed as below</p>
<p>Image tile size = (TILE_HEADER_SIZE_IN_BYTES + MAX_TILE_HEIGHT*MAX_TILE_WIDTH*sizeof(DATA_TYPE))</p>
<p>Here TILE_HEADER_SIZE_IN_BYTES is 128 bytes for current version of Tiler / Stitcher. DATA_TYPE in above example is int16_t (2 bytes).o</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Current version of HW data movers have 8_16 configuration (i.e. 8 bit image element data type on host side and 16 bit image element data type on AIE kernel side). In future more such configurations will be provided (example: 8_8 / 16_16 etc.)</p>
</div>
<p>Tiler / Stitcher IPs use PL resources available on VCK boards. For 8_16 configuration below table illustrates resource utilization numbers for theese IPs. The numbers correspond to single instance of each IP.</p>
<table border="1" class="colwidths-given docutils" id="id9">
<caption><span class="caption-text">Tiler / Stitcher resource utilization (8_16 config)</span><a class="headerlink" href="#id9" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="12%" />
<col width="18%" />
<col width="18%" />
<col width="18%" />
<col width="18%" />
<col width="18%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">&#160;</th>
<th class="head">LUTs</th>
<th class="head">FFs</th>
<th class="head">BRAMs</th>
<th class="head">DSPs</th>
<th class="head">Fmax</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><strong>Tiler</strong></td>
<td>2761</td>
<td>3832</td>
<td>5</td>
<td>13</td>
<td>400 MHz</td>
</tr>
<tr class="row-odd"><td><strong>Stitcher</strong></td>
<td>2934</td>
<td>3988</td>
<td>5</td>
<td>7</td>
<td>400 MHz</td>
</tr>
<tr class="row-even"><td><strong>Total</strong></td>
<td>5695</td>
<td>7820</td>
<td>10</td>
<td>20</td>
<td>&#160;</td>
</tr>
</tbody>
</table>
</li>
<li><p class="first">GMIO data movers</p>
<p>Transition to GMIO based data movers can be achieved by using a specialized template implementation of above class. All above constraints w.r.t Image tile size calculation are valid here as well. Sample code is shown below</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xF</span><span class="p">::</span><span class="n">xfcvDataMovers</span><span class="o">&lt;</span><span class="n">xF</span><span class="p">::</span><span class="n">TILER</span><span class="p">,</span> <span class="n">int16_t</span><span class="p">,</span> <span class="n">MAX_TILE_HEIGHT</span><span class="p">,</span> <span class="n">MAX_TILE_WIDTH</span><span class="p">,</span> <span class="n">VECTORIZATION_FACTOR</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">true</span><span class="o">&gt;</span> <span class="n">tiler</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">xF</span><span class="p">::</span><span class="n">xfcvDataMovers</span><span class="o">&lt;</span><span class="n">xF</span><span class="p">::</span><span class="n">STITCHER</span><span class="p">,</span> <span class="n">int16_t</span><span class="p">,</span> <span class="n">MAX_TILE_HEIGHT</span><span class="p">,</span> <span class="n">MAX_TILE_WIDTH</span><span class="p">,</span> <span class="n">VECTORIZATION_FACTOR</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">true</span><span class="o">&gt;</span> <span class="n">stitcher</span><span class="p">;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Last template parameter is set  to true, implying GMIO specialization.</p>
</div>
</li>
</ol>
<p>Once the objects are constructed, simple API calls can be made to initiate the data transfers. Sample code is shown below</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">For</span> <span class="n">PLIO</span>
<span class="n">auto</span> <span class="n">tiles_sz</span> <span class="o">=</span> <span class="n">tiler</span><span class="o">.</span><span class="n">host2aie_nb</span><span class="p">(</span><span class="n">src_hndl</span><span class="p">,</span> <span class="n">srcImageR</span><span class="o">.</span><span class="n">size</span><span class="p">());</span>
<span class="n">stitcher</span><span class="o">.</span><span class="n">aie2host_nb</span><span class="p">(</span><span class="n">dst_hndl</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">tiles_sz</span><span class="p">);</span>

<span class="o">//</span><span class="n">For</span> <span class="n">GMIO</span>
<span class="n">auto</span> <span class="n">tiles_sz</span> <span class="o">=</span> <span class="n">tiler</span><span class="o">.</span><span class="n">host2aie_nb</span><span class="p">(</span><span class="n">srcData</span><span class="o">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">srcImageR</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> <span class="p">{</span><span class="s2">&quot;gmioIn[0]&quot;</span><span class="p">});</span>
<span class="n">stitcher</span><span class="o">.</span><span class="n">aie2host_nb</span><span class="p">(</span><span class="n">dstData</span><span class="o">.</span><span class="n">data</span><span class="p">(),</span> <span class="n">dst</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">tiles_sz</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;gmioOut[0]&quot;</span><span class="p">});</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">GMIO data transfers take additional argument which is corresponding GMIO port to be used.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For GMIO based transfers there is a blocking method as well (host2aie(…) / aie2host(…)). For PLIO based data transfers the method only non-blocking API calls are provided.</p>
</div>
<p>Using ‘tile_sz’ user can run the graph appropriate number of times.</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">filter_graph</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tiles_sz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">tiles_sz</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</pre></div>
</div>
<p>After the runs are started, user needs to wait for all transactions to get complete.</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">filter_graph</span><span class="o">.</span><span class="n">wait</span><span class="p">();</span>
<span class="n">tiler</span><span class="o">.</span><span class="n">wait</span><span class="p">();</span>
<span class="n">stitcher</span><span class="o">.</span><span class="n">wait</span><span class="p">();</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Current implementation of xfcvDataMovers support only 1 core. Multi core support is planned for future releases.</p>
</div>
</div>
</div>
</div>
<div class="section" id="evaluating-the-functionality">
<h2>Evaluating the Functionality<a class="headerlink" href="#evaluating-the-functionality" title="Permalink to this headline">¶</a></h2>
<p>You can build the kernels and test the functionality through x86 simulation, cycle
accurate aie simulation, hw emulation or hw run on the board. Use the following
commands to setup the basic environment:</p>
<div class="section" id="x86-simulation">
<span id="id2"></span><h3>x86 Simulation<a class="headerlink" href="#x86-simulation" title="Permalink to this headline">¶</a></h3>
<p>Please refer to <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/simulate_graph_application.html#uqf1619792614896">x86 Functional Simulation</a> section in Vitis Unified Software Development Platform 2021.2 Documentation. For host code development, please refer to <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/program_ps_host_application.html#ykt1590616160037">Programming the PS Host Application</a> section</p>
</div>
<div class="section" id="aie-simulation">
<span id="id3"></span><h3>AIE Simulation<a class="headerlink" href="#aie-simulation" title="Permalink to this headline">¶</a></h3>
<p>Please refer to <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/simulate_graph_application.html#yql1512608436352">AIE Simulation</a> section in Vitis Unified Software Development Platform 2021.2 Documentation. For host code development, please refer to <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/program_ps_host_application.html#ykt1590616160037">Programming the PS Host Application</a> section.</p>
</div>
<div class="section" id="hw-emulation">
<span id="id5"></span><h3>HW emulation<a class="headerlink" href="#hw-emulation" title="Permalink to this headline">¶</a></h3>
<p>Please refer to <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/program_ps_host_application.html#ykt1590616160037">Programming the PS Host Application</a> section in Vitis Unified Software Development Platform 2021.2 Documentation.</p>
</div>
<div class="section" id="testing-on-hw">
<h3>Testing on HW<a class="headerlink" href="#testing-on-hw" title="Permalink to this headline">¶</a></h3>
<p>After the build for hardware target completes, sd_card.img file will be generated in the build directory.</p>
<ol class="arabic simple">
<li>Use a software like Etcher to flash the sd_card.img file on to a SD Card.</li>
<li>After flashing is complete, insert the SD card in the SD card slot on board and power on the board.</li>
<li>Use Teraterm to connect to COM port and wait for the system to boot up.</li>
<li>After the boot up is done, goto /media/sd-mmcblk0p1 directory and run the executable file.</li>
</ol>
<p>Please refer to <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/running_hw_app.html#lwu1600468728254">hw_run</a> section in Vitis Unified Software Development Platform 2021.2 Documentation.</p>
</div>
</div>
</div>
<div class="section" id="design-example-using-vitis-vision-aie-library">
<h1>Design example Using Vitis Vision AIE Library<a class="headerlink" href="#design-example-using-vitis-vision-aie-library" title="Permalink to this headline">¶</a></h1>
<p>Following example application performs a 2D filtering operation over a gray scale image. The
convolution kernel is a 3x3 window with floating point representation. The coefficients are
converted to fixed point representation before being passed to AIE core for computation. The
results are cross validated against OpenCV reference implementation. The example illustrates
both PLIO and GMIO based data transfers.</p>
<div class="section" id="adf-graph">
<h2>ADF Graph<a class="headerlink" href="#adf-graph" title="Permalink to this headline">¶</a></h2>
<p>An AI Engine program consists of a data flow graph specification written in C++. The dataflow graph consists of top level ports,
kernel instances and connectivity. a graph.h file is created which includes the header adf.h.</p>
<p>For more details on data flow graph creation, please refer <a class="reference external" href="https://www.xilinx.com/html_docs/xilinx2021_1/vitis_doc/ai_engine_programming.html">AI Engine Programming</a> .</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &quot;kernels.h&quot;</span>
<span class="c1">#include &lt;adf.h&gt;</span>

<span class="n">using</span> <span class="n">namespace</span> <span class="n">adf</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">myGraph</span> <span class="p">:</span> <span class="n">public</span> <span class="n">adf</span><span class="p">::</span><span class="n">graph</span> <span class="p">{</span>
   <span class="n">public</span><span class="p">:</span>
    <span class="n">kernel</span> <span class="n">k1</span><span class="p">;</span>
    <span class="n">port</span><span class="o">&lt;</span><span class="nb">input</span><span class="o">&gt;</span> <span class="n">inptr</span><span class="p">;</span>
    <span class="n">port</span><span class="o">&lt;</span><span class="n">output</span><span class="o">&gt;</span> <span class="n">outptr</span><span class="p">;</span>
    <span class="n">port</span><span class="o">&lt;</span><span class="nb">input</span><span class="o">&gt;</span> <span class="n">kernelCoefficients</span><span class="p">;</span>

  <span class="n">myGraph</span><span class="p">()</span> <span class="p">{</span>
     <span class="n">k1</span> <span class="o">=</span> <span class="n">kernel</span><span class="p">::</span><span class="n">create</span><span class="p">(</span><span class="n">filter2D</span><span class="p">);</span>
     <span class="n">adf</span><span class="p">::</span><span class="n">connect</span><span class="o">&lt;</span><span class="n">window</span><span class="o">&lt;</span><span class="n">TILE_WINDOW_SIZE</span><span class="o">&gt;</span> <span class="o">&gt;</span><span class="p">(</span><span class="n">inptr</span><span class="p">,</span> <span class="n">k1</span><span class="o">.</span><span class="ow">in</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
     <span class="n">adf</span><span class="p">::</span><span class="n">connect</span><span class="o">&lt;</span><span class="n">parameter</span><span class="o">&gt;</span><span class="p">(</span><span class="n">kernelCoefficients</span><span class="p">,</span> <span class="k">async</span><span class="p">(</span><span class="n">k1</span><span class="o">.</span><span class="ow">in</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>
     <span class="n">adf</span><span class="p">::</span><span class="n">connect</span><span class="o">&lt;</span><span class="n">window</span><span class="o">&lt;</span><span class="n">TILE_WINDOW_SIZE</span><span class="o">&gt;</span> <span class="o">&gt;</span><span class="p">(</span><span class="n">k1</span><span class="o">.</span><span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">outptr</span><span class="p">);</span>

     <span class="n">source</span><span class="p">(</span><span class="n">k1</span><span class="p">)</span> <span class="o">=</span> <span class="s2">&quot;xf_filter2d.cc&quot;</span><span class="p">;</span>
     <span class="o">//</span> <span class="n">Initial</span> <span class="n">mapping</span>
     <span class="n">runtime</span><span class="o">&lt;</span><span class="n">ratio</span><span class="o">&gt;</span><span class="p">(</span><span class="n">k1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
<div class="section" id="platform-ports">
<h2>Platform Ports<a class="headerlink" href="#platform-ports" title="Permalink to this headline">¶</a></h2>
<p>A top-level application file graph.cpp is created which contains an instance of the graph class and is connected to a simulation platform. A virtual platform specification helps to connect the data flow graph written with external I/O
mechanisms specific to the chosen target for testing or eventual deployment.</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#include &quot;graph.h&quot;</span>

<span class="o">//</span> <span class="n">Virtual</span> <span class="n">platform</span> <span class="n">ports</span>
<span class="n">PLIO</span><span class="o">*</span> <span class="n">in1</span> <span class="o">=</span> <span class="n">new</span> <span class="n">PLIO</span><span class="p">(</span><span class="s2">&quot;DataIn1&quot;</span><span class="p">,</span> <span class="n">adf</span><span class="p">::</span><span class="n">plio_64_bits</span><span class="p">,</span> <span class="s2">&quot;data/input.txt&quot;</span><span class="p">);</span>
<span class="n">PLIO</span><span class="o">*</span> <span class="n">out1</span> <span class="o">=</span> <span class="n">new</span> <span class="n">PLIO</span><span class="p">(</span><span class="s2">&quot;DataOut1&quot;</span><span class="p">,</span> <span class="n">adf</span><span class="p">::</span><span class="n">plio_64_bits</span><span class="p">,</span> <span class="s2">&quot;data/output.txt&quot;</span><span class="p">);</span>
<span class="n">simulation</span><span class="p">::</span><span class="n">platform</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">&gt;</span> <span class="n">platform</span><span class="p">(</span><span class="n">in1</span><span class="p">,</span> <span class="n">out1</span><span class="p">);</span>

<span class="o">//</span> <span class="n">Graph</span> <span class="nb">object</span>
<span class="n">myGraph</span> <span class="n">filter_graph</span><span class="p">;</span>

<span class="o">//</span> <span class="n">Virtual</span> <span class="n">platform</span> <span class="n">connectivity</span>
<span class="n">connect</span><span class="o">&lt;&gt;</span> <span class="n">net0</span><span class="p">(</span><span class="n">platform</span><span class="o">.</span><span class="n">src</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">filter_graph</span><span class="o">.</span><span class="n">inptr</span><span class="p">);</span>
<span class="n">connect</span><span class="o">&lt;&gt;</span> <span class="n">net1</span><span class="p">(</span><span class="n">filter_graph</span><span class="o">.</span><span class="n">outptr</span><span class="p">,</span> <span class="n">platform</span><span class="o">.</span><span class="n">sink</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</pre></div>
</div>
<ol class="arabic">
<li><p class="first">PLIO</p>
<p>A PLIO port attribute is used to make external stream connections that cross the AI Engine to programmable logic (PL) boundary. PLIO attributes are used to specify the port name, port bit width and the input/output file names.
Note that when simulating PLIO with data files, the data should be organized to accomodate both the width of the PL block as well as the data type of connecting port on the AI Engine block.</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">Platform</span> <span class="n">ports</span>
<span class="n">PLIO</span><span class="o">*</span> <span class="n">in1</span> <span class="o">=</span> <span class="n">new</span> <span class="n">PLIO</span><span class="p">(</span><span class="s2">&quot;DataIn1&quot;</span><span class="p">,</span> <span class="n">adf</span><span class="p">::</span><span class="n">plio_64_bits</span><span class="p">,</span> <span class="s2">&quot;data/input.txt&quot;</span><span class="p">);</span>
<span class="n">PLIO</span><span class="o">*</span> <span class="n">out1</span> <span class="o">=</span> <span class="n">new</span> <span class="n">PLIO</span><span class="p">(</span><span class="s2">&quot;DataOut1&quot;</span><span class="p">,</span> <span class="n">adf</span><span class="p">::</span><span class="n">plio_64_bits</span><span class="p">,</span> <span class="s2">&quot;data/output.txt&quot;</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p class="first">GMIO</p>
<p>A GMIO port attribute is used to make external memory-mapped connections to or from the global memory. These connections are made between an AI Engine graph and the logical global memory ports of a hardware platform design.</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">//</span><span class="n">Platform</span> <span class="n">ports</span>
<span class="n">GMIO</span> <span class="n">gmioIn1</span><span class="p">(</span><span class="s2">&quot;gmioIn1&quot;</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
<span class="n">GMIO</span> <span class="n">gmioOut</span><span class="p">(</span><span class="s2">&quot;gmioOut&quot;</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>

<span class="o">//</span><span class="n">Virtual</span> <span class="n">platform</span>
<span class="n">simulation</span><span class="p">::</span><span class="n">platform</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">&gt;</span> <span class="n">platform</span><span class="p">(</span><span class="o">&amp;</span><span class="n">gmioIn1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">gmioOut</span><span class="p">);</span>

<span class="o">//</span><span class="n">Graph</span> <span class="nb">object</span>
<span class="n">myGraph</span> <span class="n">filter_graph</span><span class="p">;</span>

<span class="o">//</span><span class="n">Platform</span> <span class="n">ports</span>
<span class="n">connect</span><span class="o">&lt;&gt;</span> <span class="n">net0</span><span class="p">(</span><span class="n">platform</span><span class="o">.</span><span class="n">src</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">filter_graph</span><span class="o">.</span><span class="n">in1</span><span class="p">);</span>
<span class="n">connect</span><span class="o">&lt;&gt;</span> <span class="n">net1</span><span class="p">(</span><span class="n">filter_graph</span><span class="o">.</span><span class="n">out1</span><span class="p">,</span> <span class="n">platform</span><span class="o">.</span><span class="n">sink</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="host-code">
<h2>Host code<a class="headerlink" href="#host-code" title="Permalink to this headline">¶</a></h2>
<p>Host code ‘host.cpp’ will be running on the host processor which conatins the code to initialize and run the datamovers and the ADF graph. XRT APIs are
used to create the required buffers in the device memory.</p>
<p>First a golden reference image is generated using OpenCV</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">run_opencv_ref</span><span class="p">(</span><span class="n">cv</span><span class="p">::</span><span class="n">Mat</span><span class="o">&amp;</span> <span class="n">srcImageR</span><span class="p">,</span> <span class="n">cv</span><span class="p">::</span><span class="n">Mat</span><span class="o">&amp;</span> <span class="n">dstRefImage</span><span class="p">,</span> <span class="nb">float</span> <span class="n">coeff</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span> <span class="p">{</span>
<span class="n">cv</span><span class="p">::</span><span class="n">Mat</span> <span class="n">tmpImage</span><span class="p">;</span>
<span class="n">cv</span><span class="p">::</span><span class="n">Mat</span> <span class="n">kernel</span> <span class="o">=</span> <span class="n">cv</span><span class="p">::</span><span class="n">Mat</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">CV_32F</span><span class="p">,</span> <span class="n">coeff</span><span class="p">);</span>
<span class="n">cv</span><span class="p">::</span><span class="n">filter2D</span><span class="p">(</span><span class="n">srcImageR</span><span class="p">,</span> <span class="n">dstRefImage</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">cv</span><span class="p">::</span><span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">cv</span><span class="p">::</span><span class="n">BORDER_REPLICATE</span><span class="p">);</span>
<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Then, xclbin is loaded on the device and the device handles are created</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xF</span><span class="p">::</span><span class="n">deviceInit</span><span class="p">(</span><span class="n">xclBinName</span><span class="p">);</span>
</pre></div>
</div>
<p>Buffers for input and output data are created using the XRT APIs and data from input CV::Mat is copied to the XRT buffer.</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">void</span><span class="o">*</span> <span class="n">srcData</span> <span class="o">=</span> <span class="n">nullptr</span><span class="p">;</span>
<span class="n">xrtBufferHandle</span> <span class="n">src_hndl</span> <span class="o">=</span> <span class="n">xrtBOAlloc</span><span class="p">(</span><span class="n">xF</span><span class="p">::</span><span class="n">gpDhdl</span><span class="p">,</span> <span class="p">(</span><span class="n">srcImageR</span><span class="o">.</span><span class="n">total</span><span class="p">()</span> <span class="o">*</span> <span class="n">srcImageR</span><span class="o">.</span><span class="n">elemSize</span><span class="p">()),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">srcData</span> <span class="o">=</span> <span class="n">xrtBOMap</span><span class="p">(</span><span class="n">src_hndl</span><span class="p">);</span>
<span class="n">memcpy</span><span class="p">(</span><span class="n">srcData</span><span class="p">,</span> <span class="n">srcImageR</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">srcImageR</span><span class="o">.</span><span class="n">total</span><span class="p">()</span> <span class="o">*</span> <span class="n">srcImageR</span><span class="o">.</span><span class="n">elemSize</span><span class="p">()));</span>

<span class="o">//</span> <span class="n">Allocate</span> <span class="n">output</span> <span class="n">buffer</span>
<span class="n">void</span><span class="o">*</span> <span class="n">dstData</span> <span class="o">=</span> <span class="n">nullptr</span><span class="p">;</span>
<span class="n">xrtBufferHandle</span> <span class="n">dst_hndl</span> <span class="o">=</span> <span class="n">xrtBOAlloc</span><span class="p">(</span><span class="n">xF</span><span class="p">::</span><span class="n">gpDhdl</span><span class="p">,</span> <span class="p">(</span><span class="n">op_height</span> <span class="o">*</span> <span class="n">op_width</span> <span class="o">*</span> <span class="n">srcImageR</span><span class="o">.</span><span class="n">elemSize</span><span class="p">()),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="n">dstData</span> <span class="o">=</span> <span class="n">xrtBOMap</span><span class="p">(</span><span class="n">dst_hndl</span><span class="p">);</span>
<span class="n">cv</span><span class="p">::</span><span class="n">Mat</span> <span class="n">dst</span><span class="p">(</span><span class="n">op_height</span><span class="p">,</span> <span class="n">op_width</span><span class="p">,</span> <span class="n">srcImageR</span><span class="o">.</span><span class="n">type</span><span class="p">(),</span> <span class="n">dstData</span><span class="p">);</span>
</pre></div>
</div>
<p>xfcvDataMovers objects tiler and stitcher are created. For more details on xfcvDataMovers refer <a class="reference internal" href="#xfcvdatamovers-aie"><span class="std std-ref">xfcvDataMovers</span></a></p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xF</span><span class="p">::</span><span class="n">xfcvDataMovers</span><span class="o">&lt;</span><span class="n">xF</span><span class="p">::</span><span class="n">TILER</span><span class="p">,</span> <span class="n">int16_t</span><span class="p">,</span> <span class="n">MAX_TILE_HEIGHT</span><span class="p">,</span> <span class="n">MAX_TILE_WIDTH</span><span class="p">,</span> <span class="n">VECTORIZATION_FACTOR</span><span class="o">&gt;</span> <span class="n">tiler</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="n">xF</span><span class="p">::</span><span class="n">xfcvDataMovers</span><span class="o">&lt;</span><span class="n">xF</span><span class="p">::</span><span class="n">STITCHER</span><span class="p">,</span> <span class="n">int16_t</span><span class="p">,</span> <span class="n">MAX_TILE_HEIGHT</span><span class="p">,</span> <span class="n">MAX_TILE_WIDTH</span><span class="p">,</span> <span class="n">VECTORIZATION_FACTOR</span><span class="o">&gt;</span> <span class="n">stitcher</span><span class="p">;</span>
</pre></div>
</div>
<p>ADF graph is initialized and the filter coefficients are updated.</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">filter_graph</span><span class="o">.</span><span class="n">init</span><span class="p">();</span>
<span class="n">filter_graph</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">filter_graph</span><span class="o">.</span><span class="n">kernelCoefficients</span><span class="p">,</span> <span class="n">float2fixed_coeff</span><span class="o">&lt;</span><span class="mi">10</span><span class="p">,</span> <span class="mi">16</span><span class="o">&gt;</span><span class="p">(</span><span class="n">kData</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">(),</span> <span class="mi">16</span><span class="p">);</span>
</pre></div>
</div>
<p>Metadata containing the tile information is generated.</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tiler</span><span class="o">.</span><span class="n">compute_metadata</span><span class="p">(</span><span class="n">srcImageR</span><span class="o">.</span><span class="n">size</span><span class="p">());</span>
</pre></div>
</div>
<p>The data transfer to AIE via datamovers is initiated along with graph run and further execution waits till the data transfer is complete.</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">auto</span> <span class="n">tiles_sz</span> <span class="o">=</span> <span class="n">tiler</span><span class="o">.</span><span class="n">host2aie_nb</span><span class="p">(</span><span class="n">src_hndl</span><span class="p">,</span> <span class="n">srcImageR</span><span class="o">.</span><span class="n">size</span><span class="p">());</span>
<span class="n">stitcher</span><span class="o">.</span><span class="n">aie2host_nb</span><span class="p">(</span><span class="n">dst_hndl</span><span class="p">,</span> <span class="n">dst</span><span class="o">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">tiles_sz</span><span class="p">);</span>

<span class="n">std</span><span class="p">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;Graph run(&quot;</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">tiles_sz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">tiles_sz</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

<span class="n">filter_graph</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tiles_sz</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">tiles_sz</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

<span class="n">filter_graph</span><span class="o">.</span><span class="n">wait</span><span class="p">();</span>
<span class="n">tiler</span><span class="o">.</span><span class="n">wait</span><span class="p">();</span>
<span class="n">stitcher</span><span class="o">.</span><span class="n">wait</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="makefile">
<span id="aie-makefile"></span><h2>Makefile<a class="headerlink" href="#makefile" title="Permalink to this headline">¶</a></h2>
<p>Run ‘make help’ to get list of commands and flows supported. Running below commands will initiate a hardware build.</p>
<div class="code c highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">&lt;</span> <span class="n">path</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">Vitis</span><span class="o">-</span><span class="n">installation</span><span class="o">-</span><span class="n">directory</span> <span class="o">&gt;/</span><span class="n">settings64</span><span class="o">.</span><span class="n">sh</span>
<span class="n">export</span> <span class="n">SYSROOT</span><span class="o">=&lt;</span> <span class="n">path</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">platform</span><span class="o">-</span><span class="n">sysroot</span> <span class="o">&gt;</span>
<span class="n">export</span> <span class="n">EDGE_COMMON_SW</span><span class="o">=&lt;</span> <span class="n">path</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">rootfs</span><span class="o">-</span><span class="ow">and</span><span class="o">-</span><span class="n">Image</span><span class="o">-</span><span class="n">files</span> <span class="o">&gt;</span>
<span class="n">make</span> <span class="nb">all</span> <span class="n">TARGET</span><span class="o">=</span><span class="n">hw</span> <span class="n">DEVICE</span><span class="o">=&lt;</span> <span class="n">path</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">platform</span><span class="o">-</span><span class="n">directory</span> <span class="o">&gt;/&lt;</span> <span class="n">platform</span> <span class="o">&gt;.</span><span class="n">xpfm</span>
</pre></div>
</div>
</div>
<div class="section" id="filter2d-pipeline-on-multiple-aie-cores">
<span id="l1-f2daiel3"></span><h2>Filter2D Pipeline on Multiple AIE Cores<a class="headerlink" href="#filter2d-pipeline-on-multiple-aie-cores" title="Permalink to this headline">¶</a></h2>
<p>This example demonstrates how a function/pipeline of functions can run on multiple AIE cores to achieve higher throughput. Back-to-back Filter2D pipeline running on three AIE cores is demonstrated in this example. The source files can be found in <code class="docutils literal notranslate"><span class="pre">L3/tests/aie/Filter2D_multicore/16bit_aie_8bit_pl</span></code> directory.</p>
<p>This example tests the performance of back-to-back Filter2D pipeline with three images being parallely processed on three AIE cores. Each AIE core is being fed by one instance of Tiler and Stitcher PL kernels.</p>
<p>The tutorial provides a step-by-step guide that covers commands for building and running the pipeline.</p>
<div class="section" id="executable-usage">
<h3>Executable Usage<a class="headerlink" href="#executable-usage" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>Work Directory(Step 1)</strong></li>
</ul>
<p>The steps for library download and environment setup can be found in README of L3 folder. Please refer <span class="xref std std-ref">Getting Started with Vitis Vision AIEngine Library Functions</span> for more details. For getting the design,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> L3/tests/aie/Filter2D_multicore/16bit_aie_8bit_pl
</pre></div>
</div>
<ul class="simple">
<li><strong>Build kernel(Step 2)</strong></li>
</ul>
<p>Run the following make command to build your XCLBIN and host binary targeting a specific device. Please be noticed that this process will take a long time, maybe couple of hours.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">DEVICE</span><span class="o">=</span>&lt; path-to-platform-directory &gt;/&lt; platform &gt;.xpfm
make all <span class="nv">TARGET</span><span class="o">=</span>hw
</pre></div>
</div>
<ul class="simple">
<li><strong>Run kernel(Step 3)</strong></li>
</ul>
<p>To get the benchmark results, please run the following command.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make run <span class="nv">TARGET</span><span class="o">=</span>hw
</pre></div>
</div>
<ul class="simple">
<li><strong>Running on HW</strong></li>
</ul>
<p>After the build for hardware target completes, sd_card.img file will be generated in the build directory.</p>
<ol class="arabic simple">
<li>Use a software like Etcher to flash the sd_card.img file on to a SD Card.</li>
<li>After flashing is complete, insert the SD card in the SD card slot on board and power on the board.</li>
<li>Use Teraterm to connect to COM port and wait for the system to boot up.</li>
<li>After the boot up is done, goto /media/sd-mmcblk0p1 directory and run the executable file.</li>
</ol>
</div>
<div class="section" id="performance">
<h3>Performance<a class="headerlink" href="#performance" title="Permalink to this headline">¶</a></h3>
<p>The performance is shown below</p>
<table border="1" class="docutils align-center" id="id10">
<caption><span class="caption-text">Table. Performance numbers in terms of FPS (Frames Per Second) for full HD images</span><a class="headerlink" href="#id10" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="61%" />
<col width="39%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Dataset</th>
<th class="head">FPS</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Full HD(1920x1080)</td>
<td>555</td>
</tr>
</tbody>
</table>
<div class="toctree-wrapper compound">
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->
</footer>

        </div>
      </div>


	  <!-- Sphinx Page Footer block -->
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="api-reference.html" class="btn btn-neutral float-right" title="Overview" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="overview.html" class="btn btn-neutral float-left" title="Overview" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">
      <span class="lastupdated">
        Last updated on October 20, 2021.
      </span>

    </p>
	<br>
  </div>
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

   <script type="text/javascript">
    jQuery(function() { Search.loadIndex("searchindex.js"); });
  </script>

  <script type="text/javascript" id="searchindexloader"></script>


  
  
    
  



  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
                  <!-- make footer fixed - NileshP -->
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
                  <!-- make footer fixed NileshP-->
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
														<div class="col-md-pull-6 col-lg-pull-6 col-md-6 col-lg-6">
															<span class="copyright">
                                  
                                  &copy; 2021, Xilinx
                              </span>
															<ul class="list-inline sub-menu">
																<li>
																	<a href="https://www.xilinx.com/about/privacy-policy.html">Privacy</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/legal.html">Legal</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/contact.html">Contact</a>
																</li>
															</ul>
														</div>
													</div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="quicklinks parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<noindex>
						<span class="quickLinks">
							<ul>
								<li>
									<a href="#top" class="btn backToTop">
									<span class="fas fa-angle-up" aria-hidden="true"></span>
									</a>
								</li>
							</ul>
						</span>
					</noindex>
				</div>
			</div>
		</div>
		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}

			underscoreSetup();
		</script>
	</body>
</html>