


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		<meta content="Vitis, Database, Vitis Database Library, Alveo" name="keywords" />
<meta content="Vitis Database Library is an open-sourced Vitis library written in C++ for accelerating database applications in a variety of use cases." name="description" />
<meta content="Document" name="xlnxdocumentclass" />
<meta content="Tutorials" name="xlnxdocumenttype" />

		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

	<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="37701bd4-e5c0-4ee3-9329-e7475d0b13a7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
		<!-- Google Tag Manager -->
	<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
	<!-- End Google Tag Manager -->
	
        <!-- Google Tag Manager -->
        <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
        <!-- End Google Tag Manager -->	

  
  
  
  

  
      <script type="text/javascript" src="_static/js/jquery.min.js"></script>
	  <script type="text/javascript" src="_static/js/gtm.js"></script>
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="_static/js/common-ui-all.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="_static/js/CoveoJsSearch.Lazy.min.js"></script>
    <script type="text/javascript" src="_static/js/linkid.js"></script>
    <script type="text/javascript" src="_static/js/Searchbox.min.js"></script>
    <script type="text/javascript" src="_static/js/header-footer.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/pro.min.css" media="all" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="L1 Module User Guide" href="guide/L1.html" />
    <link rel="prev" title="Design Flows" href="design_flows.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
 <div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">

    
    

    



<div class="xf-content-height">
    

<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
    
    <div class="header parbase aem-GridColumn aem-GridColumn--default--12"><noindex>
	<header data-component="header" class="site-header">
		<nav class="navbar navbar-default">
			<div class="container-fluid main-nav">
				<div class="row">
					<div class="navbar-column col-xs-4 col-sm-5">
						<ul class="nav navbar-nav hidden-xs">
							<li>
									<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
								</li>
							<li>
									<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
								</li>
							<li>
									<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
								</li>
							</ul>
							
						<ul class="nav navbar-nav hidden-sm hidden-md hidden-lg">
							<li>
									<button data-target="#header-container-0" data-function="toggle">Solutions</button>
								</li>
							<li>
									<button data-target="#header-container-1" data-function="toggle">Products</button>
								</li>
							<li>
									<button data-target="#header-container-2" data-function="toggle">Company</button>
								</li>
							</ul>
							
						<div id="header-container-0" class="menu-container">
								<div class="navbar-nav-container">
									<ul class="nav navbar-nav">
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
												</li>
										</ul>
									<button data-function="close-menu">
										<span class="fal fa-times" aria-hidden="true"></span>
									</button>
								</div>
							</div>
							<div id="header-container-1" class="menu-container">
								<div class="navbar-nav-container">
									<ul class="nav navbar-nav">
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
												</li>
										</ul>
									<button data-function="close-menu">
										<span class="fal fa-times" aria-hidden="true"></span>
									</button>
								</div>
							</div>
							<div id="header-container-2" class="menu-container">
								<div class="navbar-nav-container">
									<ul class="nav navbar-nav">
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
												</li>
										</ul>
									<button data-function="close-menu">
										<span class="fal fa-times" aria-hidden="true"></span>
									</button>
								</div>
							</div>
							</div>
					<div class="logo-column col-xs-4 col-sm-2">
						<div class="logo">
							<a target="_blank" href="https://www.xilinx.com/">
								<img src="https://github.com/Xilinx/Image-Collateral/blob/main/xilinx-header-logo.svg?raw=true" title="Xilinx Inc"/>
							</a>
						</div>
					</div>

				</div>
			</div>
			</nav></header></noindex></div>
		
	
</div>

    
</div>
</div>

<div class="calloutBanner parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16"><div class="callout-banner">
    Xilinx is now a part of <a target="_blank" href="https://www.amd.com/en/corporate/xilinx-acquisition">AMD</a> |  <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Learn More</a>
</div>
</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> Vitis Database Library
          

          
          </a>

          
            
            
              <div class="version">
                2021.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

      
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
            
            
              
            
            
              <p class="caption"><span class="caption-text">Library Overview</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Vitis Database Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="release.html">Release Note</a></li>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="design_flows.html">Design Flows</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Vitis Database Library Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#relational-database-and-hardware-acceleration">Relational Database and Hardware Acceleration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-vitis-database-library-works">How Vitis Database Library Works</a></li>
<li class="toctree-l2"><a class="reference internal" href="#l3-api-general-query-engine">L3 API – General Query Engine</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#target-audience-and-major-features">Target Audience and Major Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-usage">Example Usage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#l2-api-gqe-kernels">L2 API – GQE kernels</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Target Audience and Major Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-to-run-l2-cases">Command to Run L2 cases</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#l1-api">L1 API</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">Target Audience and Major Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#command-to-run-l1-cases">Command to Run L1 cases</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="guide/L1.html">L1 Module User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="gqe_guide/L2.html">L2 GQE Kernel User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="gqe_guide/L3.html">L3 GQE Overlay User Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Benchmark Result</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="benchmark.html">Benchmark</a></li>
<li class="toctree-l1"><a class="reference internal" href="benchmark/tpc_h.html">TPC-H Queries with GQE</a></li>
</ul>

            
			
				<h3>Versions</h3>
				<ul>
				  <li><a href=""></a></li>
				  <li><a href=""></a></li>
				  <li><a href=""></a></li>
				  <li><a href=""></a></li>
				  <li><a href=""></a></li>
				</ul>
			
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Vitis Database Library</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Vitis Database Library Tutorial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="vitis-database-library-tutorial">
<span id="brief"></span><h1>Vitis Database Library Tutorial<a class="headerlink" href="#vitis-database-library-tutorial" title="Permalink to this headline">¶</a></h1>
<div class="section" id="relational-database-and-hardware-acceleration">
<h2>Relational Database and Hardware Acceleration<a class="headerlink" href="#relational-database-and-hardware-acceleration" title="Permalink to this headline">¶</a></h2>
<p>Relational databases are based on relational model of data which is powerful and used for a wide variety of information.
Users only need to specify the result they want with a query language like SQL.
DBMS converts a query into an execution plan which is a tree of operators, based on certain set of rules and cost functions.
Execution of the plan is that data flows from the leaves towards the root and the root node produce the final result.
Query execution performances depends on both execution plan and performance of operator nodes.</p>
<a class="reference internal image-reference" href="images/exe_plan.png"><img alt="Execution Plan" class="align-center" src="images/exe_plan.png" /></a>
<p>Xilinx Alveo card can help improve operator performance in following way:</p>
<ol class="arabic simple">
<li>Instruction parallelism by creating a customized and long pipeline.</li>
<li>Data parallelism by processing multiple rows at the same time.</li>
<li>Customizable memory hierarchy of BRAM/URAM/HBM, providing high bandwidth of memory access to help operators like bloom filter and hash join.</li>
</ol>
</div>
<div class="section" id="how-vitis-database-library-works">
<h2>How Vitis Database Library Works<a class="headerlink" href="#how-vitis-database-library-works" title="Permalink to this headline">¶</a></h2>
<p>Vitis database library targets to help SQL engine developers to accelerate query execution.
It provides three layers of APIs, namely L1 / L2 / L3. Each tackles different parts of the whole processing.</p>
<ul class="simple">
<li>L3 provide pure software APIs for:</li>
</ul>
<ol class="arabic simple">
<li>Define data structures to describe input table / output table / operation types and parameters.</li>
<li>Provide combination of operations for acceleration. These combinations are commonly used and easy to fit into the whole execution plan.</li>
<li>Manage multiple FPGA cards automatically, including initialization of OpenCL context, command queue, kernels and buffers.</li>
<li>Break down incoming job, distributing sub jobs among all FPGA cards, pipeline data transfers and kernel executions.</li>
</ol>
<ul class="simple">
<li>L2 APIs are kernels running on FPGA cards. Each time called, they will finish certain processing according to input configs. L2 APIs are combinitions of multiple processing unit, each units consists of multiple processing stage. In this way, kernels could both processing multiple data at the same time and apply multiple operations to the same data. L2 API design subject to resource constraints and will differs according to FPGA cards.</li>
<li>L1 APIs are basic operators in processing, like filter, aggregator / bloom filter / hash join. They’re all highly optimize HLS design, providing optimal performance. They’re all template design, make them easier to scale and fit into different resource constraint.</li>
</ul>
</div>
<div class="section" id="l3-api-general-query-engine">
<h2>L3 API – General Query Engine<a class="headerlink" href="#l3-api-general-query-engine" title="Permalink to this headline">¶</a></h2>
<div class="section" id="target-audience-and-major-features">
<h3>Target Audience and Major Features<a class="headerlink" href="#target-audience-and-major-features" title="Permalink to this headline">¶</a></h3>
<p>Target audience of L3 API (General Query Engine, GQE) are users who just want to link a shared library and call the API to accelerate part of execution plan on FPGA cards.</p>
<p>The major feature of L3 API are:</p>
<ol class="arabic simple">
<li>Generalized query execution. L3 API pre-defined operator combinations like “scan + filter + aggregation + write”, “scan + filter + bloom filter + write”, “scan + filter + hash-join + write”, “scan + filter + aggregation + write”. Filter condition support comparision between 4 input columns and 2 constants. Aggregation support max / min / sum / count / mean / variance / norm_L1 / norm_L2. In this way, L3 API could support a generalized query operators.</li>
<li>Automatic card management. As soon as program created a instance of GQE, it will scan the machine and find all qualified Xilinx FPGA cards by their shell name. It will load the cards with the xclbins, create context / command queue / kernel / host buffer / device buffer / job queue for each card. It will keep alive until user call release() functions. This will finish all the initialization automatically and save the overhead to repeat such setup each time user call GQE API.</li>
</ol>
<a class="reference internal image-reference" href="images/card_mng.png"><img alt="Card Management" class="align-center" src="images/card_mng.png" /></a>
<ol class="arabic simple" start="3">
<li>Light weight memory management. The input and output of GQE are data structure call “TableSection”. It only contains pointers to memories which user allocated. In such way, GQE won’t do memory allocation related to input / output. This will make it easier for customer to integrate since it won’t impact original DBMS’s memory pool managment.</li>
<li>Asynchronous API call. Input for processing will be cut into multiple section of rows. GQE API requries customer to provide an std::future type argument for each row, to indicate readiness of input. GQE also requires an std::promise type arugment for each output section, to notify the caller thread that result is ready. GQE API will push all input arguments into an internal job queue and return immediately. Actual processing won’t begin until the corresponding std::future arguments for input is ready. This will seperate input preparing from actual GQE processing. GQE could start processing the ready sections ahead even if not all input sections are ready. It will help pipeline the “preparing” and “processing” and improve system performance.</li>
<li>Column-oriented. Columnar DBMS will benefit from only accessing subset of columns and more options for data compression.</li>
</ol>
<a class="reference internal image-reference" href="images/asyn_call.png"><img alt="Asynchronous API" class="align-center" src="images/asyn_call.png" /></a>
</div>
<div class="section" id="example-usage">
<h3>Example Usage<a class="headerlink" href="#example-usage" title="Permalink to this headline">¶</a></h3>
<pre class="highlight literal-block">
<span></span><span class="c1">// Take the short query above to demonstrate how to use L3 APIs.</span>

<span class="c1">// create GQE instance to handle card management</span>
<span class="c1">// with shell name, path to xclbin file to be loaded, operator combination</span>
<span class="n">gqe</span><span class="o">::</span><span class="n">workshop</span> <span class="n">wksp</span><span class="p">(</span><span class="s">&quot;xilinx_u280_xdma_201920_3&quot;</span><span class="p">,</span> <span class="s">&quot;./gqe_join.xclbin&quot;</span><span class="p">,</span> <span class="n">gqe</span><span class="o">::</span><span class="n">WorkerFunctions</span><span class="o">::</span><span class="n">JOIN</span><span class="p">);</span>

<span class="c1">// Define input table schema, including attributes and size of each attribute&#39;s element.</span>
<span class="c1">// Also setup if enable rowid and validation bits or not.</span>
<span class="c1">// rowid is an auto generated attribute inside kernel.</span>
<span class="c1">// validation bits represent if valid for each input rows.</span>
<span class="c1">// Table O has 1 column, of type int64_t, attribute name is &quot;o_rowid&quot;, rowID and validation bits enabled, attribute name is &quot;o_rowid&quot;, &quot;o_valid&quot;</span>
<span class="c1">// Table L has 1 column, of type int64_t, attribute name is &quot;l_rowid&quot;, rowID and validation bits enabled, attribute name is &quot;l_rowid&quot;, &quot;l_valid&quot;</span>
<span class="c1">// Table C has 3 column, of type int64_t, attribute name is &quot;c1&quot;, &quot;c2&quot;, &quot;c3&quot;, has no rowid and validation bits&quot;</span>
<span class="n">gqe</span><span class="o">::</span><span class="n">TableSection</span> <span class="n">tab_o</span><span class="p">(</span><span class="s">&quot;Table O&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;o_orderkey&quot;</span><span class="p">},</span> <span class="p">{</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int64_t</span><span class="p">)},</span> <span class="mi">1</span><span class="p">,</span> <span class="n">valid_o</span><span class="p">,</span> <span class="s">&quot;o_rowid&quot;</span><span class="p">,</span> <span class="s">&quot;o_valid&quot;</span><span class="p">);</span>
<span class="n">gqe</span><span class="o">::</span><span class="n">TableSection</span> <span class="n">tab_l</span><span class="p">(</span><span class="s">&quot;Table L&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;l_orderkey&quot;</span><span class="p">},</span> <span class="p">{</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int64_t</span><span class="p">)},</span> <span class="mi">1</span><span class="p">,</span> <span class="n">valid_l</span><span class="p">,</span> <span class="s">&quot;l_rowid&quot;</span><span class="p">,</span> <span class="s">&quot;l_valid&quot;</span><span class="p">);</span>
<span class="n">gqe</span><span class="o">::</span><span class="n">TableSection</span> <span class="n">tab_c</span><span class="p">(</span><span class="s">&quot;Table C&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;c1&quot;</span><span class="p">,</span> <span class="s">&quot;c2&quot;</span><span class="p">,</span> <span class="s">&quot;c3&quot;</span><span class="p">},</span> <span class="p">{</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int64_t</span><span class="p">),</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int64_t</span><span class="p">),</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int64_t</span><span class="p">)},</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span>

<span class="c1">// After the schema of input table has been defined, add rows by section.</span>
<span class="c1">// Each section added to TableSection should contains exactly same number of columns in the exact same order of attribute.</span>
<span class="c1">// This only add pointers, which should been valid no later than this seciton&#39;s corresponding future is ready.</span>
<span class="c1">// tab_o_col0, tab_l_col0, tab_c_col0, tab_c_col1, tab_c_col2, tab_c_col3 are pointer to input and output memory</span>
<span class="c1">// tab_o_valid, tab_l_valid is the validation bits for table O and table L, represent filter result from previous processing, as input.</span>
<span class="c1">// tab_part_o_col0, tab_part_l_col0 are pointer to intermediate partition result.</span>
<span class="n">tab_o</span><span class="p">.</span><span class="n">addSec</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">*&gt;</span><span class="p">({(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">tab_o_col0</span><span class="p">}),</span> <span class="n">tab_o_valid</span><span class="p">,</span> <span class="n">table_o_nrow</span><span class="p">);</span>
<span class="n">tab_l</span><span class="p">.</span><span class="n">addSec</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">*&gt;</span><span class="p">({(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">tab_l_col0</span><span class="p">}),</span> <span class="n">tab_l_valid</span><span class="p">,</span> <span class="n">table_l_nrow</span><span class="p">);</span>
<span class="n">tab_c</span><span class="p">.</span><span class="n">addSec</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">*&gt;</span><span class="p">({(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">tab_c_col0</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">tab_c_col1</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">tab_c_col2</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">tab_c_col3</span><span class="p">},</span> <span class="k">nullptr</span><span class="p">,</span> <span class="n">table_c_nrow</span><span class="p">);</span>
<span class="n">tab_part_o</span><span class="p">.</span><span class="n">addSec</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">*&gt;</span><span class="p">({(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">tab_part_o_col0</span><span class="p">}),</span> <span class="k">nullptr</span><span class="p">,</span> <span class="n">table_o_nrow</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>
<span class="n">tab_part_l</span><span class="p">.</span><span class="n">addSec</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">*&gt;</span><span class="p">({(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">tab_part_l_col0</span><span class="p">}),</span> <span class="k">nullptr</span><span class="p">,</span> <span class="n">table_l_nrow</span> <span class="o">*</span> <span class="mi">2</span><span class="p">);</span>


<span class="c1">// intermeidiate result will be stored in &quot;tab_part_o&quot; and &quot;tab_part_l&quot;.</span>
<span class="c1">// schema definition and adding seciton are similar</span>
<span class="n">gqe</span><span class="o">::</span><span class="n">TableSection</span> <span class="n">tab_part_o</span><span class="p">(</span><span class="s">&quot;Part O&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;o1&quot;</span><span class="p">,</span> <span class="s">&quot;o2&quot;</span><span class="p">,</span> <span class="s">&quot;o3&quot;</span><span class="p">},</span> <span class="p">{</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int64_t</span><span class="p">),</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int64_t</span><span class="p">),</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int64_t</span><span class="p">)},</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="n">gqe</span><span class="o">::</span><span class="n">TableSection</span> <span class="n">tab_part_l</span><span class="p">(</span><span class="s">&quot;Part L&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s">&quot;l1&quot;</span><span class="p">,</span> <span class="s">&quot;l2&quot;</span><span class="p">,</span> <span class="s">&quot;l3&quot;</span><span class="p">},</span> <span class="p">{</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">int64_t</span><span class="p">),</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int64_t</span><span class="p">),</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int64_t</span><span class="p">)},</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
<span class="n">tab_part_o</span><span class="p">.</span><span class="n">addSec</span><span class="p">({((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">tmp_o1</span><span class="p">),</span> <span class="p">((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">tmp_o2</span><span class="p">),</span> <span class="p">((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">tmp_o3</span><span class="p">)},</span> <span class="k">nullptr</span><span class="p">,</span> <span class="n">d_part_o_nrow</span><span class="p">);</span>
<span class="n">tab_part_l</span><span class="p">.</span><span class="n">addSec</span><span class="p">({((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">tmp_l1</span><span class="p">),</span> <span class="p">((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">tmp_l2</span><span class="p">),</span> <span class="p">((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">tmp_l3</span><span class="p">)},</span> <span class="k">nullptr</span><span class="p">,</span> <span class="n">d_part_l_nrow</span><span class="p">);</span>

<span class="c1">// Call GQE API to perform &quot;filter + hash partition + hash join&quot;</span>
<span class="c1">// This will merge the original execution plan tree into 1 operations.</span>
<span class="c1">// Table O is filtered with &quot;o_rowid&gt;0&quot;</span>
<span class="c1">// No filter and only partition on table L.</span>
<span class="c1">// To support bigger input tableSection, GQE will also performan hash partition on Table O and Table L.</span>
<span class="c1">// Join table O and table L with &quot;o_orderkey = l_orderkey&quot;, output 3 columns of l_orderkey, o_rowid and l_rowid.</span>
<span class="c1">// Join will return imediately</span>
<span class="n">wksp</span><span class="p">.</span><span class="n">Join</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tab_o</span><span class="p">,</span> <span class="s">&quot;o_rowid&gt;0&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab_o_ready</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab_part_o</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab_l</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab_l_ready</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab_part_l</span><span class="p">,</span>
      <span class="s">&quot;o_orderkey = l_orderkey&quot;</span><span class="p">,</span> <span class="s">&quot;c1=l_orderkey,c2=o_rowid,c3=l_rowid&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab_c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tab_c_ready_promise</span><span class="p">,</span>
      <span class="n">gqe</span><span class="o">::</span><span class="n">INNER_JOIN</span><span class="p">,</span> <span class="n">smanual</span><span class="p">);</span>

<span class="c1">// get future from promise</span>
<span class="n">std</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span> <span class="n">tab_c_ready</span><span class="p">;</span>
<span class="n">tab_c_ready</span> <span class="o">=</span> <span class="n">tab_c_ready_promise</span><span class="p">.</span><span class="n">get_future</span><span class="p">();</span>
<span class="c1">// wait for future</span>
<span class="n">tab_c_ready</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>

<span class="c1">// release GQE</span>
<span class="n">wksp</span><span class="p">.</span><span class="n">release</span><span class="p">();</span>
</pre>
</div>
</div>
<div class="section" id="l2-api-gqe-kernels">
<h2>L2 API – GQE kernels<a class="headerlink" href="#l2-api-gqe-kernels" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>Target Audience and Major Features<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Target audience of L2 API are users who has certian understanding of HLS and programming on FPGA and want to make modification on kernels, including:</p>
<ol class="arabic simple">
<li>Operator combinitions in kernel, like number of operators or operator pipeline. Most L1 APIs and glue logics inside L2 kernels are connect with streams. Users could add more operators into kernels to increase its performance as long as it is not bounded by other factors like logic resource and memory bandwidth.</li>
<li>Add more pre-processing and post-processing to kernel, like compression / decompression. Certain DBMS might store its data in compressed format to save the memory space and bandwidth to transfer. Adding decompression module to build longer processing pipeline will save the time to decompress the data and increase system performance.</li>
<li>Kernel combinition to be built on single cards. People might be interested in adjust the kernel combinition to accelerate execution plan with different weight.</li>
<li>Building configs to improve frequency or migrate to other Xilinx FPGA device.</li>
<li>Test correctness in sw-emu, hw-emu and on-board.</li>
</ol>
<a class="reference internal image-reference" href="_images/3in1_gqe_structure.png"><img alt="Kernel Structure" class="align-center" src="_images/3in1_gqe_structure.png" style="width: 615.2px; height: 557.6px;" /></a>
</div>
<div class="section" id="command-to-run-l2-cases">
<h3>Command to Run L2 cases<a class="headerlink" href="#command-to-run-l2-cases" title="Permalink to this headline">¶</a></h3>
<pre class="highlight literal-block">
<span></span><span class="nb">cd</span> L2/tests/vitis_case_folder

<span class="c1"># build and run one of the following using U280 platform</span>
make run <span class="nv">TARGET</span><span class="o">=</span>sw_emu <span class="nv">DEVICE</span><span class="o">=</span>/path/to/xilinx_u280_xdma_201920_3.xpfm

<span class="c1"># delete generated files</span>
make cleanall
</pre>
<p>Here, <code class="docutils literal notranslate"><span class="pre">TARGET</span></code> decides the FPGA binary type</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">sw_emu</span></code> is for software emulation</li>
<li><code class="docutils literal notranslate"><span class="pre">hw_emu</span></code> is for hardware emulation</li>
<li><code class="docutils literal notranslate"><span class="pre">hw</span></code> is for deployment on physical card. (Compilation to hardware binary often takes hours.)</li>
</ul>
<p>Besides <code class="docutils literal notranslate"><span class="pre">run</span></code>, the Vitis case makefile also allows <code class="docutils literal notranslate"><span class="pre">host</span></code> and <code class="docutils literal notranslate"><span class="pre">xclbin</span></code> as build target.</p>
</div>
</div>
<div class="section" id="l1-api">
<h2>L1 API<a class="headerlink" href="#l1-api" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id2">
<h3>Target Audience and Major Features<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>Target audience of L1 API are users who is familiar with HLS programming and want to tests / profile / modify operators or add new operator.
With the HLS test project provided in L1 layer, user could get:</p>
<ol class="arabic simple">
<li>Function correctness tests, both in c-simulation and co-simulation</li>
<li>Performance profiling from HLS synthesis report and co-simulaiton</li>
<li>Resource and timing from Vivado synthesis.</li>
</ol>
</div>
<div class="section" id="command-to-run-l1-cases">
<h3>Command to Run L1 cases<a class="headerlink" href="#command-to-run-l1-cases" title="Permalink to this headline">¶</a></h3>
<pre class="highlight literal-block">
<span></span><span class="nb">cd</span> L1/tests/hls_case_folder

make run <span class="nv">CSIM</span><span class="o">=</span><span class="m">1</span> <span class="nv">CSYNTH</span><span class="o">=</span><span class="m">0</span> <span class="nv">COSIM</span><span class="o">=</span><span class="m">0</span> <span class="nv">VIVADO_SYN</span><span class="o">=</span><span class="m">0</span> <span class="nv">VIVADO_IMPL</span><span class="o">=</span><span class="m">0</span> <span class="se">\</span>
    <span class="nv">DEVICE</span><span class="o">=</span>/path/to/xilinx_u280_xdma_201920_3.xpfm
</pre>
<p>Test control variables are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">CSIM</span></code> for high level simulation.</li>
<li><code class="docutils literal notranslate"><span class="pre">CSYNTH</span></code> for high level synthesis to RTL.</li>
<li><code class="docutils literal notranslate"><span class="pre">COSIM</span></code> for co-simulation between software test bench and generated RTL.</li>
<li><code class="docutils literal notranslate"><span class="pre">VIVADO_SYN</span></code> for synthesis by Vivado.</li>
<li><code class="docutils literal notranslate"><span class="pre">VIVADO_IMPL</span></code> for implementation by Vivado.</li>
</ul>
<p>For all these variables, setting to <code class="docutils literal notranslate"><span class="pre">1</span></code> indicates execution while <code class="docutils literal notranslate"><span class="pre">0</span></code> for skipping.
The default value of all these control variables are <code class="docutils literal notranslate"><span class="pre">0</span></code>, so they can be omitted from command line
if the corresponding step is not wanted.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->
</footer>

        </div>
      </div>


	  <!-- Sphinx Page Footer block -->
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="guide/L1.html" class="btn btn-neutral float-right" title="L1 Module User Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="design_flows.html" class="btn btn-neutral float-left" title="Design Flows" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">
      <span class="lastupdated">
        Last updated on April 13, 2022.
      </span>

    </p>
	<br>
  </div>
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

   <script type="text/javascript">
    jQuery(function() { Search.loadIndex("searchindex.js"); });
  </script>

  <script type="text/javascript" id="searchindexloader"></script>


  
  
    
  



  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
                  <!-- make footer fixed - NileshP -->
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
                  <!-- make footer fixed NileshP-->
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
														
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<div class="lang-select dropup hidden-md hidden-lg">
		<button data-toggle="dropdown">
			<span class="fas fa-globe" aria-hidden="true"></span>
			<span>
				
					English
				</span>
		<span class="far fa-angle-down" aria-hidden="true"></span>
	</button>
	<ul class="dropdown-menu">
		<li>
				<a target="_blank" href="https://japan.xilinx.com/" target="_self">
					日本語
				</a>
			</li>
		<li>
				<a target="_blank" href="https://china.xilinx.com/" target="_self">
					简体中文
				</a>
			</li>
		</ul>
	</div>
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a target="_blank" href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
																	<div class="lang-select dropup hidden-xs hidden-sm">
	<button data-toggle="dropdown">
		<span class="fas fa-globe" aria-hidden="true"></span>
		<span>
			
				English
			</span>
		<span class="far fa-angle-down" aria-hidden="true"></span>
	</button>
	<ul class="dropdown-menu">
		<li>
				<a target="_blank" href="https://japan.xilinx.com/" target="_self">
					日本語
				</a>
			</li>
		<li>
				<a target="_blank" href="https://china.xilinx.com/" target="_self">
					简体中文
				</a>
			</li>
		</ul>
	</div>
															</div>
														</div>
														<div class="col-md-pull-5 col-lg-pull-5 col-md-5 col-lg-5">
															<span class="copyright">©2022 Advanced Micro Devices, Inc</span>
														</div>

													</div>
													                    <div class="movethisrowtoleft row">
                        <div class="col-xs-24">
                            <ul class="sub-menu">
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a></li>
                                <li><a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a></li>
                                <li><a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a></li>
								<li><a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a></li>
                                <li><a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></li>
                            </ul>
                        </div>
                    </div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
<div class="backToTop parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16"><noindex>
    <span data-component="backToTopButton" class="backToTopButton loaded">
        <ul>
            <li>
                <a href="https://www.author.xilinx.com/xx/rebrand/amd/en-amd-xilinx-header-footer.html#top" class="btn top">
                    <span class="fas fa-angle-up" aria-hidden="true"></span>
                </a>
            </li>
        </ul>
    </span>
</noindex></div>
			</div>
		</div>


		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}

			underscoreSetup();
		</script>
	</body>
</html>