


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		<meta content="Vitis Database Library, GQE, join kernel, aggregate kernel, partition kernel" name="keywords" />
<meta content="GQE kernel design." name="description" />
<meta content="Document" name="xlnxdocumentclass" />
<meta content="Tutorials" name="xlnxdocumenttype" />

		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="../_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="../_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

	<!-- OneTrust Cookies Consent Notice start for xilinx.github.io -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="37701bd4-e5c0-4ee3-9329-e7475d0b13a7" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for xilinx.github.io -->
		<!-- Google Tag Manager -->
	<script type="text/plain" class="optanon-category-C0002">(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
	new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
	j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
	'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
	})(window,document,'script','dataLayer','GTM-5RHQV7');</script>
	<!-- End Google Tag Manager -->
	
        <!-- Google Tag Manager -->
        <noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-5RHQV7" height="0" width="0" style="display:none;visibility:hidden" class="optanon-category-C0002"></iframe></noscript>
        <!-- End Google Tag Manager -->	

  
  
  
  

  
      <script type="text/javascript" src="../_static/js/jquery.min.js"></script>
	  <script type="text/javascript" src="../_static/js/gtm.js"></script>
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="../_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="../_static/js/common-ui-all.min.js"></script>
    <script type="text/javascript" src="../_static/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="../_static/js/CoveoJsSearch.Lazy.min.js"></script>
    <script type="text/javascript" src="../_static/js/linkid.js"></script>
    <script type="text/javascript" src="../_static/js/Searchbox.min.js"></script>
    <script type="text/javascript" src="../_static/js/header-footer.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/pro.min.css" media="all" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="GQE Kernel APIs" href="kernel_api.html" />
    <link rel="prev" title="L2 GQE Kernel User Guide" href="L2.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
 <div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">

    
    

    



<div class="xf-content-height">
    

<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
    
    <div class="header parbase aem-GridColumn aem-GridColumn--default--12"><noindex>
	<header data-component="header" class="site-header">
		<nav class="navbar navbar-default">
			<div class="container-fluid main-nav">
				<div class="row">
					<div class="navbar-column col-xs-4 col-sm-5">
						<ul class="nav navbar-nav hidden-xs">
							<li>
									<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
								</li>
							<li>
									<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
								</li>
							<li>
									<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
								</li>
							</ul>
							
						<ul class="nav navbar-nav hidden-sm hidden-md hidden-lg">
							<li>
									<button data-target="#header-container-0" data-function="toggle">Solutions</button>
								</li>
							<li>
									<button data-target="#header-container-1" data-function="toggle">Products</button>
								</li>
							<li>
									<button data-target="#header-container-2" data-function="toggle">Company</button>
								</li>
							</ul>
							
						<div id="header-container-0" class="menu-container">
								<div class="navbar-nav-container">
									<ul class="nav navbar-nav">
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
												</li>
										</ul>
									<button data-function="close-menu">
										<span class="fal fa-times" aria-hidden="true"></span>
									</button>
								</div>
							</div>
							<div id="header-container-1" class="menu-container">
								<div class="navbar-nav-container">
									<ul class="nav navbar-nav">
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
												</li>
										</ul>
									<button data-function="close-menu">
										<span class="fal fa-times" aria-hidden="true"></span>
									</button>
								</div>
							</div>
							<div id="header-container-2" class="menu-container">
								<div class="navbar-nav-container">
									<ul class="nav navbar-nav">
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/applications.html&#39;;">Solutions</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/products/silicon-devices.html&#39;;">Products</button>
												</li>
										<li>
												<button onclick="window.location.href=&#39;https://www.xilinx.com/about/company-overview.html&#39;;">Company</button>
												</li>
										</ul>
									<button data-function="close-menu">
										<span class="fal fa-times" aria-hidden="true"></span>
									</button>
								</div>
							</div>
							</div>
					<div class="logo-column col-xs-4 col-sm-2">
						<div class="logo">
							<a target="_blank" href="https://www.xilinx.com/">
								<img src="https://github.com/Xilinx/Image-Collateral/blob/main/xilinx-header-logo.svg?raw=true" title="Xilinx Inc"/>
							</a>
						</div>
					</div>

				</div>
			</div>
			</nav></header></noindex></div>
		
	
</div>

    
</div>
</div>

<div class="calloutBanner parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16"><div class="callout-banner">
    Xilinx is now a part of <a target="_blank" href="https://www.amd.com/en/corporate/xilinx-acquisition">AMD</a> |  <a target="_blank" href="https://www.amd.com/en/corporate/privacy">Learn More</a>
</div>
</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Vitis Database Library
          

          
          </a>

          
            
            
              <div class="version">
                2021.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

      
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
            
            
            
              
            
            
              <p class="caption"><span class="caption-text">Library Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Vitis Database Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release.html">Release Note</a></li>
<li class="toctree-l1"><a class="reference internal" href="../requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design_flows.html">Design Flows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Vitis Database Library Tutorial</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../guide/L1.html">L1 Module User Guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="L2.html">L2 GQE Kernel User Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">GQE Kernel Design</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#in-1-kernel">3-in-1 Kernel</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#meta-information">Meta Information</a></li>
<li class="toctree-l4"><a class="reference internal" href="#unified-kernel-command">Unified Kernel Command</a></li>
<li class="toctree-l4"><a class="reference internal" href="#join-flow">Join Flow</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bloom-filter-flow">Bloom-Filter Flow</a></li>
<li class="toctree-l4"><a class="reference internal" href="#bit-partition-flow-with-bloom-filter-build-probe">64-bit Partition Flow with Bloom Filter Build/Probe</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#aggregate-kernel">Aggregate Kernel</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="kernel_api.html">GQE Kernel APIs</a></li>
<li class="toctree-l2"><a class="reference internal" href="kernel_config.html">GQE Kernel Configuration APIs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="L3.html">L3 GQE Overlay User Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Benchmark Result</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../benchmark.html">Benchmark</a></li>
<li class="toctree-l1"><a class="reference internal" href="../benchmark/tpc_h.html">TPC-H Queries with GQE</a></li>
</ul>

            
			
				<h3>Versions</h3>
				<ul>
				  <li><a href=""></a></li>
				  <li><a href=""></a></li>
				  <li><a href=""></a></li>
				  <li><a href=""></a></li>
				  <li><a href=""></a></li>
				</ul>
			
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Vitis Database Library</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="L2.html">L2 GQE Kernel User Guide</a> &raquo;</li>
        
      <li>GQE Kernel Design</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="gqe-kernel-design">
<span id="id1"></span><h1>GQE Kernel Design<a class="headerlink" href="#gqe-kernel-design" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="in-1-kernel">
<span id="gqe-3in1-kernel-design"></span><h2>3-in-1 Kernel<a class="headerlink" href="#in-1-kernel" title="Permalink to this headline">¶</a></h2>
<p id="gqe-3in1-kernel">The 3-in-1 GQE kernel is a compound of multiple previous released GQE kernels, containing a large number of post-bitstream programmable primitives. It can execute not only hash-join/hash-bloomfilter/hash-partition individually but also hash-based bloom filter build + partition or bloom filter probe + partition as a combination to minimize the intermdediate data transfer.
To instantiate the 3-in-1 in the resource-limited U50 Alveo for obtaining the best benefit-cost ratio, we refactored every processing unit (PU) as well as the output data paths and retired the bypass design in the current kernel, now it enpowers the Q5-simplified query can be done with a 4x performance improvement without any cost increasing on device comparing to the previous separated GQE kernels.</p>
<a class="reference internal image-reference" href="../_images/3in1_gqe_structure.png"><img alt="3-in-1 GQE Kernel" class="align-center" src="../_images/3in1_gqe_structure.png" style="width: 615.2px; height: 557.6px;" /></a>
<p>The internal structure of 3-in-1 GQE is illustrated in the figure above. Besides those challenging parts we have accomplished in previous separated GQE kernels, it is important to emphasize the necessity of the hardware structure we implemented in 3-in-1 GQE for reusing the 2 AXI-Master ports and 3 internal huge URAM buffers in each PU, as we cannot tolerate even a little of resource wastes on the device to make the gqeJoin/gqeBloomfilter/gqePart all on a single U50 comes ture.</p>
<a class="reference internal image-reference" href="../_images/reusable_hardware_structure.png"><img alt="Reusable hardware structure" class="align-center" src="../_images/reusable_hardware_structure.png" style="width: 986.4000000000001px; height: 574.4px;" /></a>
<p>The reason why we need this reusable hardware structure is because of the limitation on the resources of U50, and the different precedence of URAM and HBM in different flows. It can be described in the figure above on the left side of the vertical red line.</p>
<p><strong>JOIN build/probe flow</strong>: needs to save the total number of an unique key in the URAM first, and then save the key/payload pairs in the HBM.</p>
<p><strong>Bloom filter build/probe flow</strong>: needs HBM to access its corresponding hash-table.</p>
<p><strong>PART</strong>: needs URAM to buffer the post-partitioned key/payload pairs to get a reasonable throughput when flushing the partitioned bucket out.</p>
<p>While performing the bloom filter probe operation + PART flow, we don’t know when the key/payload pairs in a specific bucket is enough to be flushed out. To avoid implementing a duplicated URAM buffer after the partition module, we have to arrange the bloom filter operation before the partition so that we can fully utilize the original URAM in partition module to collect the partitioned rows. Thus we need this reusable hardware structure as illustrated on the right of the vertical red line in the figure above, where the data goes along with the different paths (marked with red) under different configurations.</p>
<p>The hardware resource utilization of 3-in-1 kernel is shown in the table below (post-placement). <strong>Total</strong> part contains not only the listed sub-modules resource utilization but the interconnect streams to serve for the dataflow design in 3-in-1 GQE kernel.</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="12%" />
<col width="22%" />
<col width="14%" />
<col width="12%" />
<col width="9%" />
<col width="7%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Module</td>
<td>LUT</td>
<td>LUT as memory</td>
<td>Register</td>
<td>BRAM36</td>
<td>URAM</td>
<td>DSP</td>
</tr>
<tr class="row-even"><td>AXI adapters</td>
<td>34306</td>
<td>9256</td>
<td>75782</td>
<td>159</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>Scan</td>
<td>9581</td>
<td>900</td>
<td>9581</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-even"><td>Filter</td>
<td>20480</td>
<td>3936</td>
<td>11850</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>crossbar 4-to-8</td>
<td>9044</td>
<td>15110</td>
<td>4696</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-even"><td>PU x 8</td>
<td>285419</td>
<td>47728</td>
<td>257620</td>
<td>300</td>
<td>264</td>
<td>72</td>
</tr>
<tr class="row-odd"><td>adapt sizer x 8</td>
<td>9597</td>
<td>0</td>
<td>8476</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-even"><td>collect 8-to-1</td>
<td>7147</td>
<td>0</td>
<td>8543</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>Write</td>
<td>19205</td>
<td>1612</td>
<td>22488</td>
<td>1</td>
<td>0</td>
<td>3</td>
</tr>
<tr class="row-even"><td>Total</td>
<td>424564</td>
<td>81037</td>
<td>434954</td>
<td>569</td>
<td>264</td>
<td>75</td>
</tr>
</tbody>
</table>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">In the current release, all columns are expected to have the same number of rows with the same type.</p>
</div>
<div class="section" id="meta-information">
<h3>Meta Information<a class="headerlink" href="#meta-information" title="Permalink to this headline">¶</a></h3>
<p>The input / output data columns save all raw column data. The statistic information, e.g., row number, column number, is recorded in meta information. The internal structure of meta information is shown in the figure below. It is important to make it clear that the Meta Information is used for both the input port and the output port, the same meta struct should be feed to the input as well as the output meta ports of the 3-in-1 GQE. Moreover, we use only number of input rows and section ID information before loading the actual table rows for every flows supported in 3-in-1 GQE.</p>
<a class="reference internal image-reference" href="../_images/meta_layout.png"><img alt="meta info layout" class="align-center" src="../_images/meta_layout.png" style="width: 1322.0px; height: 588.0px;" /></a>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Join/Aggr/Bloomfilter only uses the first 8 rows of meta for number of input rows &amp; section ID.</li>
<li>Part flow supports a maximum of 256 partitions, each number of rows in a partition is described by a 32-bit integer, starting from output meta[8], 256 / 16 = 16 lines are used for partitioning nrow output.</li>
<li>Size of each partition is configured through meta row 0, from 104 to 135 bits. User can achieve this by simply calling <code class="docutils literal notranslate"><span class="pre">setPartition</span></code> API in class <code class="docutils literal notranslate"><span class="pre">MetaTable</span></code> of L2.</li>
<li>When the number of partition is less than 256, the first N parts of meta row 8-23 are used, starting from meta[8][31-0] with little endian.</li>
</ul>
</div>
</div>
<div class="section" id="unified-kernel-command">
<h3>Unified Kernel Command<a class="headerlink" href="#unified-kernel-command" title="Permalink to this headline">¶</a></h3>
<p>The configuration buffer basically programs the kernel at runtime. It toggles execution step primitives on or off, and defines the filter condition. The details are documented in the following figure:</p>
<a class="reference internal image-reference" href="../_images/kernelcmd.png"><img alt="kernel command info layout" class="align-center" src="../_images/kernelcmd.png" style="width: 1850.0px; height: 856.0px;" /></a>
<p>14 lines of 512-bit configuration data are used in unified kernel command. From address 0x00 to 0x03, the 512-bit configurations are used to setting the general configuration, join configuration, partition configuration, and bloom filter configuration respectively. 0x04 is reserved for Aggregate flow. As all of the different flows shares the same dynamic filtering module, same configuration lines from 0x06 to 0x13 are used.</p>
<p>For the current implementation of 3-in-1 GQE, the supported flows can be configured through:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="19%" />
<col width="6%" />
<col width="14%" />
<col width="8%" />
<col width="8%" />
<col width="7%" />
<col width="8%" />
<col width="9%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Flow</td>
<td>Bloom filter build/probe flag</td>
<td>Dual key</td>
<td>Join build/probe flag</td>
<td>Aggr on/off</td>
<td>Part on/off</td>
<td>BF on/off</td>
<td>Join on/off</td>
<td>Bypass on/off</td>
</tr>
<tr class="row-even"><td>Join build</td>
<td>0</td>
<td>0/1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>Join probe</td>
<td>0</td>
<td>0/1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="row-even"><td>Bloom filter probe</td>
<td>1</td>
<td>0/1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>Bloom filter build / Part</td>
<td>0</td>
<td>0/1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-even"><td>Bloom filter probe / Part</td>
<td>1</td>
<td>0/1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal notranslate"><span class="pre">Dual</span> <span class="pre">key</span></code> option instructs the kernel to use only the first (by setting to 0) or both of the key columns (by setting to 1) in the flow.</p>
<p>There is no need for users to configure the 3-in-1 GQE by declaring and setting the complicated configuration bits themslves, software APIs that can be used to configure the 3-in-1 GQE are provided in <a class="reference internal" href="kernel_config.html#gqe-kernel-config-api"><span class="std std-ref">Unified Kernel Command</span></a>. They are extremly friendly to the software developers.</p>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">Directly bypass is not supported in the current 3-in-1 as resources are very limited on U50.</p>
</div>
<p>Up to 3 columns are supported for both input table A and B, which may consist of 1-2 key columns and 1 payload column. The column enable flags are set in bit 10-15. There are 4 output columns designed in 3-in-1 GQE as JOIN needs emit both the 1-2 key and the payload from table A and table B, the corresponding output column enable flags are 16-23 bits.</p>
<p>Payload column data, which is normally used as rowID column, can be assigned from user input buffer or auto-generated within the kernel. The rowID generation configuration is controlled by bit 30-33. If generating rowID inside the kernel is set to <code class="docutils literal notranslate"><span class="pre">1</span></code>, the validation enable flag also need be configured as a combination to determine whether to use the validation-bit column or not.</p>
<p>The columns are indexed starting from <code class="docutils literal notranslate"><span class="pre">0</span></code>.  <code class="docutils literal notranslate"><span class="pre">-1</span></code> is used as a special value to instruct the table scanner to feed zeros for that column.</p>
<p>The dynamic filtering configuration is aligned to lower bits. Build/probe table’s filter configurations are located in address 0x06-0x09 / 0x10-0x13 respectively.</p>
</div>
<div class="section" id="join-flow">
<h3>Join Flow<a class="headerlink" href="#join-flow" title="Permalink to this headline">¶</a></h3>
<p>Internal multi-join supports three reconfigurable modes, namely inner-join, anti-join, and semi-join. To join efficiently at different data scale, the join process is divided into two phases: build and probe. Build phase takes Table A as input to build the hash table, while Probe phase takes Table B as input and probes the conflicting rows from built hash table. By calling Table B multiple iterations, Table B that with arbitrary size can be joined. On the other hand, By spliting Table A into multiple slice and running mutli-(build + Nx probe), Table A with any size can be employed as the left table.</p>
<p>This kernel works with three types of input buffers, 1x kernel configuration buffer, 1x meta info buffer, 1x validation-bit buffer, and 3x column data buffers. The result buffers are 1x result data meta and 4x output column data.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">hash</span> <span class="pre">join</span> <span class="pre">type</span></code> option indicates the work mode of multi-join, 0 for inner-join, 1 for semi-join, and 2 for anti-join.</p>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">The 3-columns input data are scanned in via 3x 256-bit AXI ports. However, only 1x 256-bit AXI port is employed to JOIN output (up to 4 cols data. When the resulting data are huge, the write out module performance would be the bottleneck of the kernel.</p>
</div>
</div>
<div class="section" id="bloom-filter-flow">
<h3>Bloom-Filter Flow<a class="headerlink" href="#bloom-filter-flow" title="Permalink to this headline">¶</a></h3>
<p>The bloom-filter is a space-efficient probabilistic data structure that is used to test whether an element is a member of a set. False positive matches are possible, but false negatives are not - in other words, a query returns either “possibly in set” or “definitely not in set”. (from Wikipedia)</p>
<p>The 3-in-1 GQE kernel supports Bloom-Filter probe flow, that the implementation fully utilizes the high bandwidth feature of HBM to accelerate the query (both build and probe) ability and expands the capacity as large as possible at the same time.</p>
<p>Since Bloom-Filter shares the same framework as 3-in-1 GQE. Thus, the input key and payload should be 64-bit width, and 1 or 2 key column(s), 1 playoad column plus 1 validation-bit column is allowed to be applied to the kernel.</p>
<p>The input/output columns for using the bloom-filter flow can be explained as:</p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="27%" />
<col width="62%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td rowspan="4">Input</td>
<td>Column 0</td>
<td>key 0</td>
</tr>
<tr class="row-even"><td>Column 1</td>
<td>key 1 (if dual-key is enabled)</td>
</tr>
<tr class="row-odd"><td>Column 2</td>
<td>payload</td>
</tr>
<tr class="row-even"><td>Validation Column</td>
<td>input validation bits</td>
</tr>
<tr class="row-odd"><td rowspan="4">Output</td>
<td>Column 0</td>
<td>validation bits</td>
</tr>
<tr class="row-even"><td>Column 1</td>
<td>unused</td>
</tr>
<tr class="row-odd"><td>Column 2</td>
<td>unused</td>
</tr>
<tr class="row-even"><td>Column 3</td>
<td>unused</td>
</tr>
</tbody>
</table>
<p>Meanwhile, a proper size in bits of the bloom filter should be set through calling <code class="docutils literal notranslate"><span class="pre">setBloomfilterSize</span></code> API in class <code class="docutils literal notranslate"><span class="pre">KernelCommand</span></code> to get a reasonable false positive probability under a specific set of unique keys.</p>
</div>
<div class="section" id="bit-partition-flow-with-bloom-filter-build-probe">
<h3>64-bit Partition Flow with Bloom Filter Build/Probe<a class="headerlink" href="#bit-partition-flow-with-bloom-filter-build-probe" title="Permalink to this headline">¶</a></h3>
<p>The GQE partition kernel can partition the input table into corresponding clusters according to hash value of selectedkey columns. This kernel is designed to scale the problem size that can be handled by the GQE Join or Aggregate kernel. To reduce the size of intermediate data transfer, it is equipped with not only the built-in dynamic filter but also the HBM-based bloom filter.</p>
<p>It scans kernel configuration buffer, meta information buffer and 3x columns input raw data in and passes to the built-in dynamic filter. The filter condition is configured in kernel configuration buffer, from address 0x06 to 0x13. After filtering, each row data will be dispatched into one of the 8 PUs to calculate hash value of the primary key. Based on the hash value and the bloom filter build/probe flag set in the general configuration, the key and payload data will be firstly walked through the HBM-based bloom filter, and then saved to the corresponding bucket / partition. Once one bucket is full, the full bucket will trigger one time burst write which flushs data from internal URAM bucket to outside off-chip resulting buffers.</p>
<p>The logarithm of number of partition can be configured through calling <code class="docutils literal notranslate"><span class="pre">setLogPart</span></code> API in class <code class="docutils literal notranslate"><span class="pre">KernelCommand</span></code>. A maximum of 256 buckets are created in internal URAM array, each bucket buffers one time burst write and flushs the results to off-chip buffers when full. The output of partition kernel is 3x columns output data and 1x output meta information buffer.</p>
<div class="admonition attention">
<p class="first admonition-title">Attention</p>
<p class="last">The row number of each output partition is given in the output meta, from row 8 to 23. Due to the supported maximum partition number is 256, each row number takes 32 bit in meta buffer, 256/(512/32) = 16 lines are employed to save these row number information.
Besides, The partition size for each bucket should be provided in meta information by calling <code class="docutils literal notranslate"><span class="pre">setPartition</span></code> API in class <code class="docutils literal notranslate"><span class="pre">MetaTable</span></code>.</p>
</div>
</div>
</div>
<div class="section" id="aggregate-kernel">
<h2>Aggregate Kernel<a class="headerlink" href="#aggregate-kernel" title="Permalink to this headline">¶</a></h2>
<p>The Aggregate kernel is another key kernel of General Query Engine (GQE) which supports both grouping and non-grouping aggregate operations.</p>
<a class="reference internal image-reference" href="../_images/gqe_aggr_kernel.png"><img alt="GQE Aggregate Kernel" class="align-center" src="../_images/gqe_aggr_kernel.png" style="width: 801.6px; height: 348.0px;" /></a>
<p>The internal structure of this kernel is shown in the figure above. Same to join kernel, 8-cols data buffer, 1x kernel config buffer and 1x meta info buffer are employed as the kernel input. Due to the diversity of output data types, e.g., aggregate max, min, raw data, etc., 16x output column buffers are used as the output buffer. As shown in above figure, before entering into hash group aggregate module, each element in each row will be evaluated and filtered. Thus, some new elements can be generated and some rows will be discarded. Moreover, two cascaded evaluation modules are added to support more complex expression.</p>
<p>The core module of aggregate kernel is hash group aggregate, which is a multi-PU implementation and given in the following diagram. Each PU requires 2 HBM banks and some URAM memory blocks to buffer distinct
keys as well as payloads after aggregate operations. And one internal loop is implemented to consume all input rows with each iteration. Furthermore, all PUs are working in parallel to achieve higher performance.</p>
<a class="reference internal image-reference" href="../_images/gqe_aggr_detail.png"><img alt="Detais Diagram of Hash Group Aggregate" class="align-center" src="../_images/gqe_aggr_detail.png" style="width: 665.4px; height: 421.8px;" /></a>
<p>The data structure of input and output meta and raw data are same as join kernel. The configuration buffer is composed of 128 x 32-bit slots. The details of configuration buffers are listed in the table:</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="37%" />
<col width="41%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Module</td>
<td>Module Config Width</td>
<td>Position</td>
</tr>
<tr class="row-even"><td>Scan</td>
<td>64 bit</td>
<td>config[0]~config[1]</td>
</tr>
<tr class="row-odd"><td>Eval0</td>
<td>289 bit</td>
<td>config[2]~config[11]</td>
</tr>
<tr class="row-even"><td>Eval1</td>
<td>289 bit</td>
<td>config[12]~config[21]</td>
</tr>
<tr class="row-odd"><td>Filter</td>
<td>45*32 bit</td>
<td>config[22]~config[66]</td>
</tr>
<tr class="row-even"><td>Shuffle0</td>
<td>64 bit</td>
<td>config[67]~config[68]</td>
</tr>
<tr class="row-odd"><td>Shuffle1</td>
<td>64 bit</td>
<td>config[69]~config[70]</td>
</tr>
<tr class="row-even"><td>Shuffle2</td>
<td>64 bit</td>
<td>config[71]~config[72]</td>
</tr>
<tr class="row-odd"><td>Shuffle3</td>
<td>64 bit</td>
<td>config[73]~config[74]</td>
</tr>
<tr class="row-even"><td>Group Aggr</td>
<td>4*32 bit</td>
<td>config[75]~config[78]</td>
</tr>
<tr class="row-odd"><td>Column Merge</td>
<td>64 bit</td>
<td>config[79]~config[80]</td>
</tr>
<tr class="row-even"><td>Aggregate</td>
<td>1 bit</td>
<td>config[81]</td>
</tr>
<tr class="row-odd"><td>Write</td>
<td>16 bit</td>
<td>config[82]</td>
</tr>
<tr class="row-even"><td>Reserved</td>
<td><ul class="first last simple">
<li></li>
</ul>
</td>
<td>config[83]~config[127]</td>
</tr>
</tbody>
</table>
<p>The hardware resource utilization of hash group aggregate is shown in the table below (work as 180MHz).</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="11%" />
<col width="8%" />
<col width="16%" />
<col width="15%" />
<col width="11%" />
<col width="9%" />
<col width="7%" />
<col width="5%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Primitive</td>
<td>Quantity</td>
<td>LUT</td>
<td>LUT as memory</td>
<td>LUT as logic</td>
<td>Register</td>
<td>BRAM36</td>
<td>URAM</td>
<td>DSP</td>
</tr>
<tr class="row-even"><td>Scan</td>
<td>1</td>
<td>12209</td>
<td>4758</td>
<td>7451</td>
<td>18974</td>
<td>0</td>
<td>0</td>
<td>2</td>
</tr>
<tr class="row-odd"><td>Eval</td>
<td>8</td>
<td>2153</td>
<td>426</td>
<td>1727</td>
<td>2042</td>
<td>4</td>
<td>0</td>
<td>21</td>
</tr>
<tr class="row-even"><td>Filter</td>
<td>4</td>
<td>2168</td>
<td>13</td>
<td>2155</td>
<td>1764</td>
<td>0.5</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>Group Aggr</td>
<td>1</td>
<td>162202</td>
<td>27819</td>
<td>134383</td>
<td>210926</td>
<td>62</td>
<td>256</td>
<td>0</td>
</tr>
<tr class="row-even"><td>Direct Aggr</td>
<td>1</td>
<td>4349</td>
<td>0</td>
<td>4349</td>
<td>6611</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>Write</td>
<td>1</td>
<td>30938</td>
<td>9490</td>
<td>21448</td>
<td>43579</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-even"><td>AXI DDR</td>
<td>1</td>
<td>4586</td>
<td>1313</td>
<td>3273</td>
<td>78855</td>
<td>18</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-odd"><td>AXI HBM</td>
<td>1</td>
<td>20528</td>
<td>4456</td>
<td>16072</td>
<td>45416</td>
<td>124</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="row-even"><td>Total</td>
<td>&#160;</td>
<td>298470</td>
<td>60402</td>
<td>238068</td>
<td>399737</td>
<td>255</td>
<td>256</td>
<td>2</td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->
</footer>

        </div>
      </div>


	  <!-- Sphinx Page Footer block -->
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="kernel_api.html" class="btn btn-neutral float-right" title="GQE Kernel APIs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="L2.html" class="btn btn-neutral float-left" title="L2 GQE Kernel User Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">
      <span class="lastupdated">
        Last updated on April 13, 2022.
      </span>

    </p>
	<br>
  </div>
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

   <script type="text/javascript">
    jQuery(function() { Search.loadIndex("searchindex.js"); });
  </script>

  <script type="text/javascript" id="searchindexloader"></script>


  
  
    
  



  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
                  <!-- make footer fixed - NileshP -->
                  <style>
                        .footer {
                        position: fixed;
                        left: 0;
                        bottom: 0;
                        width: 100%;
                        }
                  </style>
                  <!-- make footer fixed NileshP-->
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
														
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<div class="lang-select dropup hidden-md hidden-lg">
		<button data-toggle="dropdown">
			<span class="fas fa-globe" aria-hidden="true"></span>
			<span>
				
					English
				</span>
		<span class="far fa-angle-down" aria-hidden="true"></span>
	</button>
	<ul class="dropdown-menu">
		<li>
				<a target="_blank" href="https://japan.xilinx.com/" target="_self">
					日本語
				</a>
			</li>
		<li>
				<a target="_blank" href="https://china.xilinx.com/" target="_self">
					简体中文
				</a>
			</li>
		</ul>
	</div>
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a target="_blank" href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a target="_blank" href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
																	<div class="lang-select dropup hidden-xs hidden-sm">
	<button data-toggle="dropdown">
		<span class="fas fa-globe" aria-hidden="true"></span>
		<span>
			
				English
			</span>
		<span class="far fa-angle-down" aria-hidden="true"></span>
	</button>
	<ul class="dropdown-menu">
		<li>
				<a target="_blank" href="https://japan.xilinx.com/" target="_self">
					日本語
				</a>
			</li>
		<li>
				<a target="_blank" href="https://china.xilinx.com/" target="_self">
					简体中文
				</a>
			</li>
		</ul>
	</div>
															</div>
														</div>
														<div class="col-md-pull-5 col-lg-pull-5 col-md-5 col-lg-5">
															<span class="copyright">©2022 Advanced Micro Devices, Inc</span>
														</div>

													</div>
													                    <div class="movethisrowtoleft row">
                        <div class="col-xs-24">
                            <ul class="sub-menu">
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/copyright">Terms and Conditions</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/privacy">Privacy</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/cookies">Cookie Policy</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/trademarks">Trademarks</a></li>
                                <li><a target="_blank" href="https://www.amd.com/system/files/documents/statement-human-trafficking-forced-labor.pdf">Statement on Forced Labor</a></li>
                                <li><a target="_blank" href="https://www.amd.com/en/corporate/competition">Fair and Open Competition</a></li>
                                <li><a target="_blank" href="https://www.amd.com/system/files/documents/amd-uk-tax-strategy.pdf">UK Tax Strategy</a></li>
								<li><a target="_blank" href="https://docs.xilinx.com/v/u/9x6YvZKuWyhJId7y7RQQKA">Inclusive Terminology</a></li>
                                <li><a href="#cookiessettings" class="ot-sdk-show-settings">Cookies Settings</a></li>
                            </ul>
                        </div>
                    </div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
<div class="backToTop parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16"><noindex>
    <span data-component="backToTopButton" class="backToTopButton loaded">
        <ul>
            <li>
                <a href="https://www.author.xilinx.com/xx/rebrand/amd/en-amd-xilinx-header-footer.html#top" class="btn top">
                    <span class="fas fa-angle-up" aria-hidden="true"></span>
                </a>
            </li>
        </ul>
    </span>
</noindex></div>
			</div>
		</div>


		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}

			underscoreSetup();
		</script>
	</body>
</html>